YUI.add("bewype-editor-tag",function(E){var D="",B="",A="",C=null;D+='<div class="{editorClass}-place">';D+="</div>";B+='<div class="{editorClass} {buttonClass}">';B+="</div>";A+='<div class="{editorClass}">';A+="{label}";A+='<div class="{spinnerClass}"></div>';A+="</div>";C=function(F){C.superclass.constructor.apply(this,arguments);};C.NAME="bewype-editor-tag";C.NS="bewypeEditorTag";C.ATTRS={editorClass:{value:"bewype-editor-tag",writeOnce:true,validator:function(F){return E.Lang.isString(F);}},activeButtons:{value:["height","width","padding-left","padding-top","bold","italic","underline","title","font-family","font-size","reset","apply"],writeOnce:true},panelNode:{value:null,writeOnce:true},selectionColor:{value:"#ddd",writeOnce:true,validator:function(F){return E.Lang.isString(F);}},spinnerLabelHeight:{value:"height",writeOnce:true,validator:function(F){return E.Lang.isString(F);}},spinnerLabelWidth:{value:"width",writeOnce:true,validator:function(F){return E.Lang.isString(F);}},spinnerLabelPaddingLeft:{value:"padding-left",writeOnce:true,validator:function(F){return E.Lang.isString(F);}},spinnerLabelPaddingTop:{value:"padding-top",writeOnce:true,validator:function(F){return E.Lang.isString(F);}},spinnerMaxHeight:{value:480,writeOnce:true,validator:function(F){return E.Lang.isNumber(F);}},spinnerMaxWidth:{value:640,writeOnce:true,validator:function(F){return E.Lang.isNumber(F);}}};E.extend(C,E.Plugin.Base,{_editor:null,_buttonDict:{},_spinnerButtons:["height","width","padding-left","padding-top"],_spinnerValues:{},_toggleButtons:["bold","italic","underline"],_pickerButtons:["title","font-family","font-size","color","background-color","url"],_pickerObjDict:{"background-color":E.Bewype.PickerColor,"color":E.Bewype.PickerColor,"font-family":E.Bewype.PickerFontFamily,"font-size":E.Bewype.PickerFontSize,"title":E.Bewype.PickerTitle,"url":E.Bewype.PickerUrl},_tagButtons:["bold","italic","title","underline","url"],_cssButtons:["font-family","font-size","color","background-color"],_initSpinnerValues:function(){var G=this.get("host"),F=E.Bewype.Utils.getCssDict(G),H=null;H=function(J,M){var N=["height","width"].indexOf(J)!=-1,L=J.split("-"),K=L.indexOf("border")!=-1,I=L.indexOf("padding")!=-1;if(N||K||I){this._spinnerValues[J]=M;}return M;};E.JSON.stringify(F,E.bind(H,this));},_addSpinnerButton:function(K){var I=this.get("panelNode"),M=this.get("editorClass")+"-button",H=this.get("editorClass")+"-spinner-"+K,F=null,L=null,J=this._spinnerValues[K],G=J?parseInt(J.replace(/px/i,""),10):0;F=new E.Node.create(E.substitute(A,{editorClass:M,label:this.get(E.Bewype.Utils.camelize("spinner-label-"+K)),spinnerClass:H}));I.append(F);L=new E.Bewype.EntrySpinner({srcNode:F.one("."+H),max:this.get(E.Bewype.Utils.camelize("spinner-max-"+K)),min:0,value:G});L.render();L.on("entry:onChange",E.bind(this._onSpinnerEventChange,this,K));this._buttonDict[K]=L;},__buttonFactory:function(I,G,K){var H=this.get("panelNode"),L=this.get("editorClass"),M=null,F=null,J=null;M=new E.Node.create(E.substitute(B,{editorClass:L+"-button",buttonClass:L+"-button-"+I}));H.append(M);K.render(M);if(G==="button"){F="button:onClick";}else{F="button:onChange";}K.on(F,E.bind(this._onButtonEventChange,this,I));if(this._pickerButtons.indexOf(I)!=-1){J="button:onClick";K.before(J,E.bind(this._onButtonEventClick,this,I));}this._buttonDict[I]=K;},_addButton:function(F){var G=new E.Bewype.Button({label:F});this.__buttonFactory(F,"button",G);},_addToggleButton:function(F){var G=new E.Bewype.ButtonToggle({label:F});this.__buttonFactory(F,"toggle-button",G);},_addPickerButton:function(F,H){var G=new E.Bewype.ButtonPicker({label:F,pickerObj:H});this.__buttonFactory(F,"picker-button",G);},_initPanel:function(){var F=this.get("activeButtons");E.Object.each(this._spinnerButtons,function(H,G){if(F.indexOf(H)!=-1){this._addSpinnerButton(H);}},this);this._updateSpinnerMaxWidth();E.Object.each(this._toggleButtons,function(H,G){if(F.indexOf(H)!=-1){this._addToggleButton(H);}},this);E.Object.each(this._pickerButtons,function(H,G){if(F.indexOf(H)!=-1){this._addPickerButton(H,this._pickerObjDict[H]);}},this);this._addButton("reset");this._addButton("apply");},initializer:function(F){this._initSpinnerValues();this._initPanel();E.publish("bewype-editor-tag:onClose");E.publish("bewype-editor-tag:onChange");},destructor:function(){var G=this.get("editorClass"),F=this.get("panelNode");E.Object.each(this.get("activeButtons"),function(I,H){this._buttonDict[I].destroy();delete (this._buttonDict[I]);},this);F.all("."+G+"-button").each(function(I,H){I.remove();});},_hasLeftBlank:function(F){if(F.length===0){return false;}else{if(F.substring(0,1).trim().length===0){return true;}}return false;},_hasRightBlank:function(F){if(F.length===0){return false;}else{if(F.substring(F.length-1,F.length).trim().length===0){return true;}}return false;},_getInnerHTML:function(I,G){var H=I._node?I._node:I,F=H.innerHTML,J="";J+=this._hasLeftBlank(F)?"&nbsp;":"";J+=F.trim();J+=this._hasRightBlank(F)?"&nbsp;":"";return G?J:J.trim()===""?null:new E.Node.create(J);},_getWorkingTagName:function(F,G){switch(F){case"bold":return"b";case"italic":return"i";case"title":var H=this._buttonDict[F];return G?H.getPrevious():H.getValue();case"underline":return"u";case"url":return"a";default:return"span";}},_removeTagOrStyle:function(G,F,H){if(G&&G._node.innerHTML){G.all(F).each(function(K,J){var L=null,I=null,M=null;if(H){L=E.Bewype.Utils.getCssDict(K);if(L[H]){delete (L[H]);if(H==="background-color"){delete (L.display);}}E.Bewype.Utils.setCssDict(K,L);M=E.Object.keys(L).length;if(M!==0){return;}}I=this._getInnerHTML(K);if(!I){K.remove();}else{K.replace(I);}},this);}},_updateStyle:function(G){var H=this.get("host"),F=this._buttonDict[G].getValue();H.setStyle(E.Bewype.Utils.camelize(G),F);},_resetStyle:function(){var F=this.get("host");E.Object.each(["h1","h2","h3","h4","span","a","b","i","u"],function(H,G){this._removeTagOrStyle(F,H);},this);},_getStyleValue:function(G){var H=this.get("host"),F=null;if(G==="url"){return H.get("href");
}else{F=E.Bewype.Utils.getCssDict(H);return F[G];}},_refreshButtons:function(H,F){var G=this.get("host"),I=F?[F]:this._toggleButtons;E.Object.each(I,function(L,K){if(this.get("activeButtons").indexOf(L)===-1){return;}var J=null;switch(L){case"bold":J=H?false:G.one("b")!==null;return this._buttonDict[L].setValue(J);case"italic":J=H?false:G.one("i")!==null;return this._buttonDict[L].setValue(J);case"underline":J=H?false:G.one("u")!==null;return this._buttonDict[L].setValue(J);case"font-family":case"font-size":case"color":case"background-color":J=H?false:this._getStyleValue(L);return this._buttonDict[L].setValue(J);case"url":J=H?false:this._getStyleValue(L);return this._buttonDict[L].setValue(J);}},this);},_onButtonEventChange:function(I,L){switch(I){case"apply":this.get("host").unplug(E.Bewype.EditorTag);return E.fire("bewype-editor-tag:onClose");case"cancel":break;default:break;}var K=this.get("host"),H=this._buttonDict[I].getValue(),G=null,J=null,F=null;G=this._getWorkingTagName(I,true);if(G){this._removeTagOrStyle(K,G,I);}G=this._getWorkingTagName(I);if(H&&(H===true||H.trim()!=="")){if(I==="url"){J=E.Node.create('<a href="'+H+'"></a>');}else{J=E.Node.create("<"+G+"></"+G+">");}if(this._cssButtons.indexOf(I)!=-1){J.setStyle(E.Bewype.Utils.camelize(I),H);if(I==="background-color"){J.setStyle("display","inline-block");}}J.append(this._getInnerHTML(K));K.setContent(J);}else{if(I==="reset"){this._resetStyle();this._refreshButtons(true);}}E.fire("bewype-editor-tag:onChange");},_onButtonEventClick:function(F,H){var G=this.get("activeButtons");E.Object.each(this._pickerButtons,function(J,I){if(G.indexOf(J)!=-1&&J!=F){this._buttonDict[J].hidePicker();}},this);this._refreshButtons(false,F);},_updateSpinnerMaxWidth:function(){var K=this.get("spinnerMaxWidth"),I=this._buttonDict["padding-left"],G=this._buttonDict.width,H=I?I.getValue():0,L=G?G.getValue():0,F=G?K-L:K,J=I?K-H:K;if(I){I.set("max",F);}if(G){G.set("max",J);}return{"padding-left":F,"width":J};},_onSpinnerEventChange:function(F,N){var L=this.get("host"),M=this._buttonDict[F],K=E.Bewype.Utils.getCssDict(L),I=K[F],G=I?parseInt(I.replace(/px/i,""),10):0,H=M.getValue(),J=(F=="padding-left")?H/2:H,O=this._updateSpinnerMaxWidth();if(O[F]&&J>O[F]){M.setValue(G);}else{L.setStyle(E.Bewype.Utils.camelize(F),H+"px");E.fire("bewype-editor-tag:onChange");}}});E.augment(C,E.EventTarget);E.namespace("Bewype");E.Bewype.EditorTag=C;},"@VERSION@",{requires:["bewype-button","bewype-entry-spinner","bewype-utils","dataschema","event-custom","json-stringify","plugin"]});