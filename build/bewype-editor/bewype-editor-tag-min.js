YUI.add("bewype-editor-tag",function(e){var d="",b="",a="",c=null;d+='<div class="{editorClass}-place">';d+="</div>";b+='<div class="{editorClass} {buttonClass}">';b+="</div>";a+='<div class="{editorClass}">';a+="{label}";a+='<div class="{spinnerClass}"></div>';a+="</div>";c=function(f){c.superclass.constructor.apply(this,arguments);};c.NAME="bewype-editor-tag";c.NS="bewypeEditorTag";c.ATTRS={editorClass:{value:"bewype-editor-tag",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},activeButtons:{value:["height","width","padding-top","padding-right","padding-bottom","padding-left","bold","italic","file","title","font-family","font-size","reset","apply"],writeOnce:true},panelNode:{value:null,writeOnce:true},selectionColor:{value:"#ddd",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},spinnerLabelHeight:{value:"height",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},spinnerLabelWidth:{value:"width",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},spinnerMaxHeight:{value:480,writeOnce:true,validator:function(f){return e.Lang.isNumber(f);}},spinnerMaxWidth:{value:640,writeOnce:true,validator:function(f){return e.Lang.isNumber(f);}},spinnerLabelPaddingTop:{value:"padding-top",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},spinnerLabelPaddingRight:{value:"padding-right",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},spinnerLabelPaddingBottom:{value:"padding-bottom",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},spinnerLabelPaddingLeft:{value:"padding-left",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},fileStaticPath:{value:e.config.doc.location.href+"static/",writeOnce:true,validator:function(f){return e.Lang.isString(f);}},uploadUrl:{value:e.config.doc.location.href+"upload",writeOnce:true}};e.extend(c,e.Plugin.Base,{_editor:null,_buttonDict:{},_spinnerButtons:["height","width","padding-top","padding-right","padding-bottom","padding-left"],_spinnerValues:{},_toggleButtons:["bold","italic","underline"],_pickerButtons:["title","font-family","font-size","color","background-color","url","file"],_pickerObjDict:{"background-color":e.Bewype.PickerColor,"color":e.Bewype.PickerColor,"file":e.Bewype.PickerFile,"font-family":e.Bewype.PickerFontFamily,"font-size":e.Bewype.PickerFontSize,"title":e.Bewype.PickerTitle,"url":e.Bewype.PickerUrl},_tagButtons:["bold","italic","title","underline","url"],_cssButtons:["font-family","font-size","color","background-color"],_initSpinnerValues:function(){var h=this.get("host"),f=e.Bewype.Utils.getCssDict(h),j=null,i=e.Bewype.Utils.getHeight(h)+"px",g=e.Bewype.Utils.getWidth(h)+"px";if(!e.Object.hasKey(f,"height")){h.setStyle("height",i);f.height=i;}if(!e.Object.hasKey(f,"width")){h.setStyle("width",g);f.width=g;}j=function(l,q){var p=l==="height",m=l==="width",o=l.split("-"),o=l.split("-"),n=o.indexOf("border")!=-1,k=o.indexOf("padding")!=-1;if(p||m||n||k){this._spinnerValues[l]=q;}return q;};e.JSON.stringify(f,e.bind(j,this));},_addSpinnerButton:function(k){var i=this.get("panelNode"),m=this.get("editorClass")+"-button",h=this.get("editorClass")+"-spinner-"+k,f=null,l=null,j=this._spinnerValues[k],g=j?parseInt(j.replace(/px/i,""),10):0;f=new e.Node.create(e.substitute(a,{editorClass:m,label:this.get(e.Bewype.Utils.camelize("spinner-label-"+k)),spinnerClass:h}));i.append(f);l=new e.Bewype.EntrySpinner({srcNode:f.one("."+h),max:this.get(e.Bewype.Utils.camelize("spinner-max-"+k)),min:0,value:g});l.render();l.on("entry:onChange",e.bind(this._onSpinnerEventChange,this,k));this._buttonDict[k]=l;},__buttonFactory:function(i,g,k){var h=this.get("panelNode"),l=this.get("editorClass"),m=null,f=null,j=null;m=new e.Node.create(e.substitute(b,{editorClass:l+"-button",buttonClass:l+"-button-"+i}));h.append(m);k.render(m);if(g==="button"){f="button:onClick";}else{f="button:onChange";}k.on(f,e.bind(this._onButtonEventChange,this,i));if(this._pickerButtons.indexOf(i)!=-1){j="button:onClick";k.before(j,e.bind(this._onButtonEventClick,this,i));}this._buttonDict[i]=k;},_addButton:function(f){var g=new e.Bewype.Button({label:f});this.__buttonFactory(f,"button",g);},_addToggleButton:function(f){var g=new e.Bewype.ButtonToggle({label:f});this.__buttonFactory(f,"toggle-button",g);},_addPickerButton:function(f,h){var g=new e.Bewype.ButtonPicker({label:f,pickerObj:h});this.__buttonFactory(f,"picker-button",g);},_initPanel:function(){var f=this.get("activeButtons");e.Object.each(this._spinnerButtons,function(h,g){if(f.indexOf(h)!=-1){this._addSpinnerButton(h);}},this);this._updateSpinnerMaxWidth();e.Object.each(this._toggleButtons,function(h,g){if(f.indexOf(h)!=-1){this._addToggleButton(h);}},this);e.Object.each(this._pickerButtons,function(h,g){if(f.indexOf(h)!=-1){this._addPickerButton(h,this._pickerObjDict[h]);}},this);this._addButton("reset");this._addButton("apply");},initializer:function(f){this._initSpinnerValues();this._initPanel();this._refreshButtons(true);e.publish("bewype-editor-tag:onClose");e.publish("bewype-editor-tag:onChange");},destructor:function(){var g=this.get("editorClass"),f=this.get("panelNode");e.Object.each(this.get("activeButtons"),function(i,h){this._buttonDict[i].destroy();delete (this._buttonDict[i]);},this);f.all("."+g+"-button").each(function(i,h){i.remove();});},_hasLeftBlank:function(f){if(f.length===0){return false;}else{if(f.substring(0,1).trim().length===0){return true;}}return false;},_hasRightBlank:function(f){if(f.length===0){return false;}else{if(f.substring(f.length-1,f.length).trim().length===0){return true;}}return false;},_getInnerHTML:function(i,g){var h=i._node?i._node:i,f=h.innerHTML,j="";j+=this._hasLeftBlank(f)?"&nbsp;":"";j+=f.trim();j+=this._hasRightBlank(f)?"&nbsp;":"";return g?j:j.trim()===""?null:new e.Node.create(j);},_getWorkingTagName:function(f,g){switch(f){case"bold":return"b";case"italic":return"i";case"title":var h=this._buttonDict[f];return g?h.getPrevious():h.getValue();case"underline":return"u";
case"url":return"a";default:return"span";}},_removeTagOrStyle:function(g,f,h){if(g&&g._node.innerHTML){g.all(f).each(function(l,j){var m=null,i=null,n=null;if(h){m=e.Bewype.Utils.getCssDict(l);if(m[h]){delete (m[h]);if(h==="background-color"){delete (m.display);}}e.Bewype.Utils.setCssDict(l,m);n=e.Object.keys(m).length;if(n!==0){return;}}i=this._getInnerHTML(l);if(!i){l.remove();}else{l.replace(i);}},this);}},_updateStyle:function(g){var h=this.get("host"),f=this._buttonDict[g].getValue();h.setStyle(e.Bewype.Utils.camelize(g),f);},_resetStyle:function(){var f=this.get("host");e.Object.each(["h1","h2","h3","h4","span","a","b","i","u"],function(h,g){this._removeTagOrStyle(f,h);},this);},_getStyleValue:function(g){var h=this.get("host"),f=null;if(g==="url"){return h.get("href");}else{f=e.Bewype.Utils.getCssDict(h);return f[g];}},_refreshButtons:function(h,f){var g=this.get("host"),i=f?[f]:this._toggleButtons;e.Object.each(i,function(m,l){if(this.get("activeButtons").indexOf(m)===-1){return;}var j=null;switch(m){case"bold":j=h?false:g.one("b")!==null;return this._buttonDict[m].setValue(j);case"italic":j=h?false:g.one("i")!==null;return this._buttonDict[m].setValue(j);case"underline":j=h?false:g.one("u")!==null;return this._buttonDict[m].setValue(j);case"file":this._buttonDict.height.setValue(g._node.height);this._buttonDict.width.setValue(g._node.width);return;case"font-family":case"font-size":case"color":case"background-color":j=h?false:this._getStyleValue(m);return this._buttonDict[m].setValue(j);case"url":j=h?false:this._getStyleValue(m);return this._buttonDict[m].setValue(j);}},this);},_onButtonEventChange:function(i,m){var k=this.get("host"),h=k.get("tagName"),g=this._buttonDict[i].getValue(),l=(i==="file")?(this.get("fileStaticPath")+g):null,f=null,j=null;switch(i){case"apply":this.get("host").unplug(e.Bewype.EditorTag);return e.fire("bewype-editor-tag:onClose");case"cancel":break;case"file":if(h&&h.toLowerCase()==="img"){k.setAttribute("src",l);k.setStyle("height",null);k.setStyle("width",null);this._refreshButtons(false,i);return e.fire("bewype-editor-tag:onChange");}return;default:break;}f=this._getWorkingTagName(i,true);if(f){this._removeTagOrStyle(k,f,i);}f=this._getWorkingTagName(i);if(g&&(g===true||g.trim()!=="")){if(i==="url"){j=e.Node.create('<a href="'+g+'"></a>');}else{j=e.Node.create("<"+f+"></"+f+">");}if(this._cssButtons.indexOf(i)!=-1){j.setStyle(e.Bewype.Utils.camelize(i),g);if(i==="background-color"){j.setStyle("display","inline-block");}}j.append(this._getInnerHTML(k));k.setContent(j);}else{if(i==="reset"){this._resetStyle();this._refreshButtons(true);}}e.fire("bewype-editor-tag:onChange");},_onButtonEventClick:function(f,h){var g=this.get("activeButtons");e.Object.each(this._pickerButtons,function(j,i){if(g.indexOf(j)!=-1&&j!=f){this._buttonDict[j].hidePicker();}},this);this._refreshButtons(false,f);},_updateSpinnerMaxWidth:function(){var j=this.get("spinnerMaxWidth"),m=this._buttonDict["padding-left"],l=this._buttonDict["padding-right"],f=this._buttonDict.width,k=m?m.getValue():0,g=l?l.getValue():0,h=f?f.getValue():0,h=f?f.getValue():0,o=f?j-h-g:j,i=f?j-h-k:j,n=m?j-k-g:j;if(m){m.set("max",o);}if(f){f.set("max",n);}return{"padding-left":o,"padding-right":i,"width":n};},_onSpinnerEventChange:function(f,n){var l=this.get("host"),m=this._buttonDict[f],k=e.Bewype.Utils.getCssDict(l),i=k[f],g=i?parseInt(i.replace(/px/i,""),10):0,h=m.getValue(),j=(f=="padding-left"||f=="padding-right")?h/2:h,o=this._updateSpinnerMaxWidth();if(o[f]&&j>o[f]){m.setValue(g);}else{l.setStyle(e.Bewype.Utils.camelize(f),h+"px");e.fire("bewype-editor-tag:onChange");}}});e.augment(c,e.EventTarget);e.namespace("Bewype");e.Bewype.EditorTag=c;},"@VERSION@",{requires:["bewype-button","bewype-entry-spinner","bewype-utils","dataschema","event-custom","json-stringify","plugin"]});