YUI.add("bewype-editor-panel",function(D){var B="",A="",C=null;B+='<div class="{editorClass} {buttonClass}">';B+="</div>";A+='<div class="{editorClass}">';A+="{label}";A+='<div class="{spinnerClass}"></div>';A+="</div>";C=function(E){C.superclass.constructor.apply(this,arguments);};C.NAME="bewype-editor-panel";C.NS="bewypeEditorPanel";D.extend(C,D.Bewype.EditorConfig,{_buttonDict:{},_editors:[],_spinnerButtons:["height","width","padding-top","padding-right","padding-bottom","padding-left"],_toggleButtons:["bold","italic","underline"],_pickerButtons:["title","font-family","font-size","color","background-color","url","file"],_pickerObjDict:{"background-color":D.Bewype.PickerColor,"color":D.Bewype.PickerColor,"file":D.Bewype.PickerFile,"font-family":D.Bewype.PickerFontFamily,"font-size":D.Bewype.PickerFontSize,"title":D.Bewype.PickerTitle,"url":D.Bewype.PickerUrl},_tagButtons:["bold","italic","title","underline","url"],_cssButtons:["font-family","font-size","color","background-color"],_addSpinnerButton:function(E,F){var J=this.get("host"),I=this.get("editorClass")+"-button",G=this.get("editorClass")+"-spinner-"+E,L=null,K=null,H=F.spinnerValues[E],M=H?parseInt(H.replace(/px/i,""),10):0;L=new D.Node.create(D.substitute(A,{editorClass:I,label:this.get(D.Bewype.Utils.camelize("spinner-label-"+E)),spinnerClass:G}));J.append(L);K=new D.Bewype.EntrySpinner({srcNode:L.one("."+G),max:this.get(D.Bewype.Utils.camelize("spinner-max-"+E)),min:0,value:M});K.render();K.on("entry:onChange",D.bind(this._onSpinnerChange,this,E));this._buttonDict[E]=K;},__buttonFactory:function(G,F,J){var I=this.get("host"),K=this.get("editorClass"),L=null,E=null,H=null;L=new D.Node.create(D.substitute(B,{editorClass:K+"-button",buttonClass:K+"-button-"+G}));I.append(L);J.render(L);if(F==="button"){E="button:onClick";}else{E="button:onChange";}J.on(E,D.bind(this._onButtonChange,this,G));if(this._pickerButtons.indexOf(G)!=-1){H="button:onClick";J.before(H,D.bind(this._onButtonClick,this,G));}this._buttonDict[G]=J;},_addButton:function(E){var F=new D.Bewype.Button({label:E});this.__buttonFactory(E,"button",F);},_addToggleButton:function(E){var F=new D.Bewype.ButtonToggle({label:E});this.__buttonFactory(E,"toggle-button",F);},_addPickerButton:function(E,G){var F=new D.Bewype.ButtonPicker({label:E,pickerObj:G});this.__buttonFactory(E,"picker-button",F);},_initPanel:function(E){var F=this.get("activeButtons");D.Object.each(this._spinnerButtons,function(H,G){if(F.indexOf(H)!=-1){this._addSpinnerButton(H,E);}},this);this.updateSpinnerMaxWidth();D.Object.each(this._toggleButtons,function(H,G){if(F.indexOf(H)!=-1){this._addToggleButton(H);}},this);D.Object.each(this._pickerButtons,function(H,G){if(F.indexOf(H)!=-1){this._addPickerButton(H,this._pickerObjDict[H]);}},this);this._addButton("reset");this._addButton("apply");},initializer:function(E){this._initPanel(E);D.publish("bewype-editor:onClose");D.publish("bewype-editor:onChange");},destructor:function(){var E=this.get("host"),F=this.get("editorClass");D.Object.each(this.get("activeButtons"),function(H,G){this._buttonDict[H].destroy();delete (this._buttonDict[H]);},this);E.all("."+F+"-button").each(function(H,G){H.remove();});D.Object.each(this._editors,function(H,G){if(H.bewypeEditorTag){H.unplug(D.Bewype.EditorTag);}else{if(H.bewypeEditorText){H.unplug(D.Bewype.EditorText);}else{return;}}this.unRegisterEditor(H);},this);},registerEditor:function(E){if(this._editors.indexOf(E)==-1){this._editors.push(E);}},unRegisterEditor:function(E){var F=this._editors.indexOf(E);if(F!=-1){this._editors.splice(F,1);}},getWorkingTagName:function(F,G){switch(F){case"bold":return"b";case"italic":return"i";case"title":var H=this._buttonDict[F],E=G?H.getPrevious():H.getValue();return E==="normal"?null:E;case"underline":return"u";case"url":return"a";default:return"span";}},getButton:function(E){return this._buttonDict[E];},isCssButton:function(E){return this._cssButtons.indexOf(E)!=-1;},_getStyleValue:function(G,F){if(!G){return null;}else{if(F==="url"){return G.get("href");}else{var E=D.Bewype.Utils.getCssDict(G);return E[F];}}},refreshButtons:function(G,F,E){if(!G){return;}var H=E?[E]:this.get("activeButtons");D.Object.each(H,function(K,J){if(this.get("activeButtons").indexOf(K)===-1){return;}var I=null;switch(K){case"bold":I=F?false:G.one("b")!==null;return this._buttonDict[K].setValue(I);case"italic":I=F?false:G.one("i")!==null;return this._buttonDict[K].setValue(I);case"underline":I=F?false:G.one("u")!==null;return this._buttonDict[K].setValue(I);case"file":this._buttonDict.height.setValue(G._node.height);this._buttonDict.width.setValue(G._node.width);return;case"font-family":case"font-size":case"color":case"background-color":I=F?false:this._getStyleValue(G,K);return this._buttonDict[K].setValue(I);case"url":I=F?false:this._getStyleValue(G,K);return this._buttonDict[K].setValue(I);}},this);},updateSpinnerMaxWidth:function(){var I=this.get("spinnerMaxWidth"),L=this._buttonDict["padding-left"],K=this._buttonDict["padding-right"],E=this._buttonDict.width,J=L?L.getValue():0,F=K?K.getValue():0,G=E?E.getValue():0,N=E?I-G-F:I,H=E?I-G-J:I,M=L?I-J-F:I;if(L){L.set("max",N);}if(E){E.set("max",M);}return{"padding-left":N,"padding-right":H,"width":M};},_onButtonClick:function(E,G){var F=this.get("activeButtons");D.Object.each(this._pickerButtons,function(I,H){if(F.indexOf(I)!=-1&&I!=E){this._buttonDict[I].hidePicker();}},this);D.each(this._editors,function(J,I){var H=J.bewypeEditorTag||J.bewypeEditorText;H.onButtonClick(E,G);});},_onButtonChange:function(E,G){if(E==="apply"){this.get("host").unplug(D.Bewype.EditorPanel);return D.fire("bewype-editor:onClose");}var F=false;D.each(this._editors,function(J,I){var H=J.bewypeEditorTag||J.bewypeEditorText;F|=H.onButtonChange(E,G);});return F?D.fire("bewype-editor:onChange"):null;},_onSpinnerChange:function(E,G){var F=false;D.each(this._editors,function(J,I){var H=J.bewypeEditorTag||J.bewypeEditorText;F|=H.onSpinnerChange(E,G);});return F?D.fire("bewype-editor:onChange"):null;
}});D.augment(C,D.EventTarget);D.namespace("Bewype");D.Bewype.EditorPanel=C;},"@VERSION@",{requires:["bewype-button","bewype-entry-spinner","bewype-utils","dataschema","event-custom","json-stringify","bewype-editor-config"]});