YUI.add("bewype-editor-panel",function(d){var b="",a="",c=null;b+='<div class="{editorClass} {buttonClass}">';b+="</div>";a+='<div class="{editorClass}">';a+="{label}";a+='<div class="{spinnerClass}"></div>';a+="</div>";c=function(e){c.superclass.constructor.apply(this,arguments);};c.NAME="bewype-editor-panel";c.NS="bewypeEditorPanel";d.extend(c,d.Bewype.EditorConfig,{_buttonDict:{},_editors:[],_spinnerButtons:["height","width","padding-top","padding-right","padding-bottom","padding-left"],_toggleButtons:["bold","italic","underline"],_pickerButtons:["title","font-family","font-size","text-align","color","background-color","url","file"],_pickerObjDict:{"background-color":d.Bewype.PickerColor,"color":d.Bewype.PickerColor,"file":d.Bewype.PickerFile,"font-family":d.Bewype.PickerFontFamily,"font-size":d.Bewype.PickerFontSize,"text-align":d.Bewype.PickerTextAlign,"title":d.Bewype.PickerTitle,"url":d.Bewype.PickerUrl},_tagButtons:["bold","italic","title","underline","url"],_cssButtons:["font-family","font-size","text-align","color","background-color"],_addSpinnerButton:function(e,f){var j=this.get("host"),i=this.get("editorClass")+"-button",g=this.get("editorClass")+"-spinner-"+e,l=null,k=null,h=f.spinnerValues[e],m=h?parseInt(h.replace(/px/i,""),10):0;l=new d.Node.create(d.substitute(a,{editorClass:i,label:this.get(d.Bewype.Utils.camelize("spinner-label-"+e)),spinnerClass:g}));j.append(l);k=new d.Bewype.EntrySpinner({srcNode:l.one("."+g),max:this.get(d.Bewype.Utils.camelize("spinner-max-"+e)),min:0,value:m});k.render();k.on("entry:onChange",d.bind(this._onSpinnerChange,this,e));this._buttonDict[e]=k;},__buttonFactory:function(g,f,j){var i=this.get("host"),k=this.get("editorClass"),l=null,e=null,h=null;l=new d.Node.create(d.substitute(b,{editorClass:k+"-button",buttonClass:k+"-button-"+g}));i.append(l);j.render(l);if(f==="button"){e="button:onClick";}else{e="button:onChange";}j.on(e,d.bind(this._onButtonChange,this,g));if(this._pickerButtons.indexOf(g)!=-1){h="button:onClick";j.before(h,d.bind(this._onButtonClick,this,g));}this._buttonDict[g]=j;},_addButton:function(e){var f=new d.Bewype.Button({label:e});this.__buttonFactory(e,"button",f);},_addToggleButton:function(e){var f=new d.Bewype.ButtonToggle({label:e});this.__buttonFactory(e,"toggle-button",f);},_addPickerButton:function(e,g){var f=new d.Bewype.ButtonPicker({label:e,pickerObj:g});this.__buttonFactory(e,"picker-button",f);},_initPanel:function(e){var f=this.get("activeButtons");d.Object.each(this._spinnerButtons,function(h,g){if(f.indexOf(h)!=-1){this._addSpinnerButton(h,e);}},this);this.updateSpinnerMaxWidth();d.Object.each(this._toggleButtons,function(h,g){if(f.indexOf(h)!=-1){this._addToggleButton(h);}},this);d.Object.each(this._pickerButtons,function(h,g){if(f.indexOf(h)!=-1){this._addPickerButton(h,this._pickerObjDict[h]);}},this);this._addButton("reset");this._addButton("apply");},initializer:function(e){this._initPanel(e);d.publish("bewype-editor:onClose");d.publish("bewype-editor:onChange");},destructor:function(){var e=this.get("host"),f=this.get("editorClass");d.Object.each(this.get("activeButtons"),function(h,g){this._buttonDict[h].destroy();delete (this._buttonDict[h]);},this);e.all("."+f+"-button").each(function(h,g){h.remove();});d.Object.each(this._editors,function(h,g){if(h.bewypeEditorTag){h.unplug(d.Bewype.EditorTag);}else{if(h.bewypeEditorText){h.unplug(d.Bewype.EditorText);}else{return;}}this.unRegisterEditor(h);},this);},registerEditor:function(e){if(this._editors.indexOf(e)==-1){this._editors.push(e);}},unRegisterEditor:function(e){var f=this._editors.indexOf(e);if(f!=-1){this._editors.splice(f,1);}},getWorkingTagName:function(f,g){switch(f){case"bold":return"b";case"italic":return"i";case"title":var h=this._buttonDict[f],e=g?h.getPrevious():h.getValue();return e==="normal"?null:e;case"underline":return"u";case"url":return"a";default:return"span";}},getButton:function(e){return this._buttonDict[e];},isCssButton:function(e){return this._cssButtons.indexOf(e)!=-1;},_getStyleValue:function(g,f){if(!g){return null;}else{if(f==="url"){return g.get("href");}else{var e=d.Bewype.Utils.getCssDict(g);return e[f];}}},refreshButtons:function(g,f,e){if(!g){return;}var h=e?[e]:this.get("activeButtons");d.Object.each(h,function(l,j){if(this.get("activeButtons").indexOf(l)===-1){return;}var i=null;switch(l){case"bold":i=f?false:g.one("b")!==null;return this._buttonDict[l].setValue(i);case"italic":i=f?false:g.one("i")!==null;return this._buttonDict[l].setValue(i);case"underline":i=f?false:g.one("u")!==null;return this._buttonDict[l].setValue(i);case"file":this._buttonDict.height.setValue(g._node.height);this._buttonDict.width.setValue(g._node.width);return;case"font-family":case"font-size":case"color":case"background-color":i=f?false:this._getStyleValue(g,l);return this._buttonDict[l].setValue(i);case"url":i=f?false:this._getStyleValue(g,l);return this._buttonDict[l].setValue(i);}},this);},updateSpinnerMaxWidth:function(){var i=this.get("spinnerMaxWidth"),l=this._buttonDict["padding-left"],k=this._buttonDict["padding-right"],e=this._buttonDict.width,j=l?l.getValue():0,f=k?k.getValue():0,g=e?e.getValue():0,n=e?i-g-f:i,h=e?i-g-j:i,m=e?i-j-f:i;if(l){l.set("max",n);}if(e){e.set("max",m);}if(k){k.set("max",h);}return{"padding-left":n,"padding-right":h,"width":m};},_onButtonClick:function(f,h){var g=this.get("activeButtons");d.Object.each(this._pickerButtons,function(i,e){if(g.indexOf(i)!=-1&&i!=f){this._buttonDict[i].hidePicker();}},this);d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;e.onButtonClick(f,h);});},_onButtonChange:function(f,h){if(f==="apply"){this.get("host").unplug(d.Bewype.EditorPanel);return d.fire("bewype-editor:onClose");}var g=false;d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;g|=e.onButtonChange(f,h);});return g?d.fire("bewype-editor:onChange"):null;},_onSpinnerChange:function(f,h){var g=false;d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;
g|=e.onSpinnerChange(f,h);});return g?d.fire("bewype-editor:onChange"):null;}});d.augment(c,d.EventTarget);d.namespace("Bewype");d.Bewype.EditorPanel=c;},"@VERSION@",{requires:["bewype-button","bewype-entry-spinner","bewype-utils","dataschema","event-custom","json-stringify","bewype-editor-config"]});