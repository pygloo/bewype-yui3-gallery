YUI.add("bewype-editor-panel",function(d){var b="",a="",c=null;b+='<div class="{editorClass} {buttonClass}">';b+="</div>";a+='<div class="{editorClass} {buttonClass}">';a+='<div class="{editorClass}-label {buttonClass}-label">{label}</div>';a+='<div class="{spinnerClass}"></div>';a+="</div>";c=function(e){c.superclass.constructor.apply(this,arguments);};c.NAME="bewype-editor-panel";c.NS="bewypeEditorPanel";d.extend(c,d.Bewype.EditorConfig,{_buttonDict:{},_editors:[],_spinnerButtons:["height","width","padding-top","padding-right","padding-bottom","padding-left"],_toggleButtons:["bold","italic","underline"],_pickerButtons:["title","font-family","font-size","text-align","color","background-color","url","file"],_pickerObjDict:{"background-color":d.Bewype.PickerColor,"color":d.Bewype.PickerColor,"file":d.Bewype.PickerFile,"font-family":d.Bewype.PickerFontFamily,"font-size":d.Bewype.PickerFontSize,"text-align":d.Bewype.PickerTextAlign,"title":d.Bewype.PickerTitle,"url":d.Bewype.PickerUrl},_tagButtons:["bold","italic","title","underline","url"],_cssButtons:["font-family","font-size","text-align","color","background-color","padding-top","padding-right","padding-bottom","padding-left"],_addSpinnerButton:function(e,f){var j=this.get("host"),i=this.get("editorClass")+"-button",g=this.get("editorClass")+"-spinner-"+e,l=null,k=null,h=f.spinnerValues[e],m=h?parseInt(h.replace(/px/i,""),10):0;l=new d.Node.create(d.substitute(a,{editorClass:i,buttonClass:i+"-button-"+e,label:this.get(d.Bewype.Utils.camelize("spinner-label-"+e)),spinnerClass:g}));j.append(l);k=new d.Bewype.EntrySpinner({srcNode:l.one("."+g),max:this.get(d.Bewype.Utils.camelize("spinner-max-"+e)),min:0,value:m});k.render();k.on("entry:onChange",d.bind(this._onSpinnerChange,this,e));this._buttonDict[e]=k;return{height:d.Bewype.Utils.getHeight(l),width:d.Bewype.Utils.getWidth(l)};},__buttonFactory:function(g,f,j){var i=this.get("host"),k=this.get("editorClass"),l=null,e=null,h=null;l=new d.Node.create(d.substitute(b,{editorClass:k+"-button",buttonClass:k+"-button-"+g}));i.append(l);j.render(l);if(f==="button"){e="button:onClick";}else{e="button:onChange";}j.on(e,d.bind(this._onButtonChange,this,g));if(this._pickerButtons.indexOf(g)!=-1){h="button:onClick";j.before(h,d.bind(this._onButtonClick,this,g));}this._buttonDict[g]=j;return{height:d.Bewype.Utils.getHeight(l),width:d.Bewype.Utils.getWidth(l)};},_addButton:function(e){var f=new d.Bewype.Button({label:e});return this.__buttonFactory(e,"button",f);},_addToggleButton:function(e){var f=new d.Bewype.ButtonToggle({label:e});return this.__buttonFactory(e,"toggle-button",f);},_addPickerButton:function(f,h){var e=f==="background-color"||f==="color",i={fileStaticPath:f==="file"?this.get("fileStaticPath"):null,uploadUrl:f==="file"?this.get("uploadUrl"):null,pickerSize:e?this.get("pickerColorSize"):null},g=new d.Bewype.ButtonPicker({label:f,pickerObj:h,pickerParams:i,pickerPosition:this.get("panelPosition")});return this.__buttonFactory(f,"picker-button",g);},_initPanel:function(f){var m=this.get("host"),k=this.get("editorClass"),j=this.get("panelPosition"),i=this.get("panelOffsetX"),h=this.get("panelOffsetY"),e=this.get("activeButtons"),l=null,n=this.get("panelPadding"),o=0,g=0;d.Object.each(this._spinnerButtons,function(q,p){var r=null;if(e.indexOf(q)!=-1){r=this._addSpinnerButton(q,f);o+=r.height+4;g+=r.width+4;}},this);this.updateSpinnerMaxWidth();d.Object.each(this._toggleButtons,function(q,p){var r=null;if(e.indexOf(q)!=-1){r=this._addToggleButton(q);o+=r.height+4;g+=r.width+4;}},this);d.Object.each(this._pickerButtons,function(q,p){var r=null;if(e.indexOf(q)!=-1){r=this._addPickerButton(q,this._pickerObjDict[q]);o+=r.height+4;g+=r.width+4;}},this);l=this._addButton("reset");o+=l.height;g+=l.width;l=this._addButton("apply");o+=l.height;g+=l.width;o+=n;g+=n;m.addClass(k);m.addClass(k+"-"+j);m.setStyle("display","block");m.setStyle(j,i);m.setStyle("top",h);if(j==="left"||j==="right"){m.setStyle("height",o);}else{m.setStyle("width",g);}},initializer:function(e){this._initPanel(e);d.publish("bewype-editor:onClose");d.publish("bewype-editor:onChange");},destructor:function(){var e=this.get("host"),f=this.get("editorClass"),g=this.get("panelPosition");e.removeClass(f);e.removeClass(f+"-"+g);e.setStyle("display","none");d.Object.each(this.get("activeButtons"),function(i,h){this._buttonDict[i].destroy();delete (this._buttonDict[i]);},this);e.all("."+f+"-button").each(function(i,h){i.remove();});d.Object.each(this._editors,function(i,h){if(i.bewypeEditorTag){i.unplug(d.Bewype.EditorTag);}else{if(i.bewypeEditorText){i.unplug(d.Bewype.EditorText);}else{return;}}this.unRegisterEditor(i);},this);},registerEditor:function(e){if(this._editors.indexOf(e)==-1){this._editors.push(e);}},unRegisterEditor:function(e){var f=this._editors.indexOf(e);if(f!=-1){this._editors.splice(f,1);}},getWorkingTagName:function(f,g){switch(f){case"bold":return"b";case"italic":return"i";case"title":var h=this._buttonDict[f],e=g?h.getPrevious():h.getValue();return e==="normal"?null:e;case"underline":return"u";case"url":return"a";default:return"span";}},getButton:function(e){return this._buttonDict[e];},isCssButton:function(e){return this._cssButtons.indexOf(e)!=-1;},_getStyleValue:function(g,f){if(!g){return null;}else{if(f==="url"){return g.get("href");}else{var e=d.Bewype.Utils.getCssDict(g);return e[f];}}},refreshButtons:function(g,f,e){if(!g){return;}var h=e?[e]:this.get("activeButtons");d.Object.each(h,function(l,j){if(this.get("activeButtons").indexOf(l)===-1){return;}var i=null;switch(l){case"bold":i=f?false:g.one("b")!==null;return this._buttonDict[l].setValue(i);case"italic":i=f?false:g.one("i")!==null;return this._buttonDict[l].setValue(i);case"underline":i=f?false:g.one("u")!==null;return this._buttonDict[l].setValue(i);case"file":if(this._buttonDict.height){this._buttonDict.height.setValue(g._node.height);}if(this._buttonDict.width){this._buttonDict.width.setValue(g._node.width);}return;case"font-family":case"font-size":case"color":case"background-color":i=f?false:this._getStyleValue(g,l);
return this._buttonDict[l].setValue(i);case"url":i=f?false:this._getStyleValue(g,l);return this._buttonDict[l].setValue(i);}},this);},updateSpinnerMaxWidth:function(){var i=this.get("spinnerMaxWidth"),l=this._buttonDict["padding-left"],k=this._buttonDict["padding-right"],e=this._buttonDict.width,j=l?l.getValue():0,f=k?k.getValue():0,g=e?e.getValue():0,n=e?i-g-f:i,h=e?i-g-j:i,m=e?i-j-f:i;if(l){l.set("max",n);}if(e){e.set("max",m);}if(k){k.set("max",h);}return{"padding-left":n,"padding-right":h,"width":m};},_onButtonClick:function(f,h){var g=this.get("activeButtons");d.Object.each(this._pickerButtons,function(i,e){if(g.indexOf(i)!=-1&&i!=f){this._buttonDict[i].hidePicker();}},this);d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;e.onButtonClick(f,h);});},_onButtonChange:function(f,h){if(f==="apply"){this.get("host").unplug(d.Bewype.EditorPanel);return d.fire("bewype-editor:onClose");}var g=false;d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;g|=e.onButtonChange(f,h);});return g?d.fire("bewype-editor:onChange"):null;},_onSpinnerChange:function(f,h){var g=false;d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;g|=e.onSpinnerChange(f,h);});return g?d.fire("bewype-editor:onChange"):null;}});d.augment(c,d.EventTarget);d.namespace("Bewype");d.Bewype.EditorPanel=c;},"@VERSION@",{requires:["bewype-button","bewype-entry-spinner","bewype-utils","dataschema","event-custom","json-stringify","bewype-editor-config"]});