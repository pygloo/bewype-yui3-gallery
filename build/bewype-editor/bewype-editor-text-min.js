YUI.add("bewype-editor-text",function(C){var B="",D="",A=null;B+='<div class="{editorClass}-place">';B+="</div>";D+='<img src="{filePath}" />';A=function(E){A.superclass.constructor.apply(this,arguments);};A.NAME="bewype-editor-text";A.NS="bewypeEditorText";A.ATTRS={};C.extend(A,C.Bewype.EditorBase,{_editor:null,_oMainCssdict:{},_initEditor:function(){var G=this.get("host"),H=this.get("editorClass"),F=C.Bewype.Utils.getCssDict(G),E=G.get("innerHTML"),I=null;G.set("innerHTML","");I=new C.Node.create(C.substitute(B,{editorClass:H}));G.append(I);this._editor=new C.EditorBase({content:E});this._editor.render(I);this._editor.after("nodeChange",C.bind(this._onEditorChange,this));return F;},_initContent:function(H){var F=this.get("host"),I=this.get("editorClass")+"-place",L=F.one("."+I),G=this._editor.getInstance(),J=G.one("body"),K=null,E={};K=function(N,Q){var R=["height","width"].indexOf(N)!=-1,P=N.split("-"),O=P.indexOf("border")!=-1,M=P.indexOf("padding")!=-1;if(R||O||M){L.setStyle(C.Bewype.Utils.camelize(N),Q);E[N]=Q;}else{if(N){J.setStyle(C.Bewype.Utils.camelize(N),Q);}}return Q;};this._oMainCssdict.height="100%";this._oMainCssdict.width="100%";C.each(["iframe","html","body"],function(N,M){var O=F.one(N)||G.one(N);O.setStyle("cssText","padding: 0px; margin: 0px; height: 100%; width: 100%;");});C.JSON.stringify(H,C.bind(K,this));F.setStyle("cssText","");return E;},initializer:function(G){var F=this._initEditor(),E=this._initContent(F);this._init(G,E);},destructor:function(){if(!this._editor){return;}var E=this.get("host"),H=this.get("editorClass"),G="."+H+"-place",K=E.one(G),I=this._editor.getInstance().one("body"),F=I.one(".selection"),J=null;this._editor.hide();if(F){F.replace(this.getInnerHTML(F));}E.set("innerHTML",I.get("innerHTML"));J=function(L,M,N){if(M){if(L==="content"&&(M.split("-").indexOf("padding")!=-1||M==="height"||M==="width")){}else{E.setStyle(C.Bewype.Utils.camelize(M),N);}}return N;};C.JSON.stringify(C.Bewype.Utils.getCssDict(K),C.bind(J,this,"place"));C.JSON.stringify(C.Bewype.Utils.getCssDict(I),C.bind(J,this,"content"));this._editor.destroy();},updateStyle:function(G){var I=this.get("host"),L=["height","width"].indexOf(G)!=-1,K=G.split("-"),E=K.indexOf("padding")!=-1,H=null,J=this._panel.getButton(G),F=J?J.getValue():null;if(L||E){H=I.one("."+this.get("editorClass")+"-place");}else{H=this._editor.getInstance().one("body");}H.setStyle(C.Bewype.Utils.camelize(G),F);},_clearSelection:function(H,F,E){if(H.clear){H.clear();}else{if(H.removeAllRanges){F.detach();H.removeAllRanges();}else{return;}}if(E!==false){var G=this._editor.getInstance(),I=G.one("body");this.removeTagOrStyle(I,".selection");}},_isFocusNodeFisrt:function(N){var G=this._editor.getInstance(),J=G.one("body")._node,K=N.anchorNode,P=N.focusNode,F=N.anchorOffset,O=N.focusOffset,L=J.innerHTML?J.innerHTML:J.textContent,M=K.innerHTML?K.innerHTML:K.textContent,E=P.innerHTML?P.innerHTML:P.textContent,I=0,H=0;if(K==P){return O<F;}else{I=L.indexOf(M);H=L.indexOf(E);return H<I;}},_ensureRangeFirstNode:function(H,E,L){var G=this._editor.getInstance(),F=G.one("body")._node,J=0,K=null;if(L.parentNode!=F){try{while(L.parentNode&&L.parentNode!=F){L=L.parentNode;J+=1;if(J==10){break;}}E.setStartBefore(L);}catch(I){K=I;return this._clearSelection(H,E);}}else{if(H.anchorOffset===0&&!H.anchorNode.previousSibling){E.setStart(F,0);}}return true;},_ensureRangeLastNode:function(H,E,K){var G=this._editor.getInstance(),F=G.one("body")._node,J=0,L=null;if(K.parentNode!=F){try{while(K.parentNode&&K.parentNode!=F){K=K.parentNode;J+=1;if(J==10){break;}}E.setEndAfter(K);}catch(I){L=I;return this._clearSelection(H,E);}}return true;},_refreshSelectionNode:function(){var E=this._editor.getInstance(),F=E.one(".selection"),G=this.get("selectionColor");if(!F){return;}F.setStyle("backgroundColor",G);F.setStyle("display","inline-block");},_updateSelection:function(){var K=this.get("host"),G=this._editor.getInstance(),H=G.one("body"),F=H.one(".selection"),L=C.Bewype.Utils.getSelection(K),J=C.Bewype.Utils.getRange(L),M=null,E=null;if(!L.anchorNode||!L.focusNode){return this._clearSelection(L,J);}if(F){F.replace(this.getInnerHTML(F));}if(L.anchorNode!=L.focusNode||L.anchorOffset!=L.focusOffset){if(this._isFocusNodeFisrt(L)){M=L.focusNode;E=L.anchorNode;}else{M=L.anchorNode;E=L.focusNode;}if(!this._ensureRangeFirstNode(L,J,M)){return;}if(!this._ensureRangeLastNode(L,J,E)){return;}try{F=C.Node.create('<span class="selection"></span>');H.append(F);J.surroundContents(H.one(".selection")._node);}catch(I){return this._clearSelection(L,J);}this._clearSelection(L,J,false);}else{this.removeTagOrStyle(H,".selection");}this._panel.refreshButtons(F);this._refreshSelectionNode();},_insertNodeToSelection:function(I){var F=this.get("host"),H=this._editor.getInstance(),K=H.one("body"),L=C.Bewype.Utils.getWindow(F),E=C.Bewype.Utils.getDocument(F),G=null,J=null;if(L._node.getSelection){G=L._node.getSelection();if(G.rangeCount>0){J=G.getRangeAt(0);K.append(I);J.insertNode(I._node);}}else{J=E._node.selection.createRange();J.collapse(true);J.pasteHTML(I._node);}},_onEditorChange:function(E){if(E.changedEvent.type==="dblclick"){}else{if(E.changedEvent.type==="mouseup"){this._updateSelection();}}},onButtonClick:function(E,H){var F=this._editor.getInstance(),G=F.one(".selection");this._panel.refreshButtons(G,false,E);},onButtonChange:function(E,K){var H=this._editor.getInstance(),I=H.one("body"),G=I.one(".selection"),O=this._panel.getButton(E),P=O?O.getValue():null,L=null,F=null,J=null,M=null,N=null;if(!G){if(this._panel.isCssButton(E)){this.updateStyle(E);return true;}else{if(E==="file"){L=C.Node.create(C.substitute(D,{filePath:this.get("fileStaticPath")+P}));this._insertNodeToSelection(L);return true;}else{if(E==="reset"){this.resetStyle(I);C.Bewype.Utils.setCssDict(I,this._oMainCssdict);return true;}}}}else{if(E==="file"){}else{F=this._panel.getWorkingTagName(E,true);if(F){this.removeTagOrStyle(G,F,E);}F=this._panel.getWorkingTagName(E);if(P&&(P===true||P.trim()!=="")){if(E==="url"){J=C.Node.create('<a href="'+P+'"></a>');
}else{J=C.Node.create("<"+F+"></"+F+">");}if(this._panel.isCssButton(E)){J.setStyle(C.Bewype.Utils.camelize(E),P);if(E==="background-color"){J.setStyle("display","inline-block");}}M=C.Node.create('<span class="selection"></span>');M.append(J);M.one(F).append(this.getInnerHTML(G));G.replace(M);}else{if(E==="reset"){this.resetStyle(G,true);this._panel.refreshButtons(G,true);}}this._refreshSelectionNode();return true;}}return false;},onSpinnerChange:function(F,E){var G=this.get("host"),H=this.get("editorClass")+"-place",I=G.one("."+H);return this._onSpinnerChange(I,F,E);}});C.augment(A,C.EventTarget);C.namespace("Bewype");C.Bewype.EditorText=A;},"@VERSION@",{requires:["bewype-editor-base","editor"]});