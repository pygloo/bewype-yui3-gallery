YUI.add("bewype-editor-text",function(c){var b="",d="",a=null;b+='<div class="{editorClass}-place">';b+="</div>";d+='<img src="{filePath}" />';a=function(e){a.superclass.constructor.apply(this,arguments);};a.NAME="bewype-editor-text";a.NS="bewypeEditorText";a.ATTRS={};c.extend(a,c.Bewype.EditorBase,{_editor:null,_oMainCssdict:{},_initEditor:function(){var g=this.get("host"),h=this.get("editorClass"),f=c.Bewype.Utils.getCssDict(g),e=g.get("innerHTML"),i=null;g.set("innerHTML","");i=new c.Node.create(c.substitute(b,{editorClass:h}));g.append(i);this._editor=new c.EditorBase({content:e});this._editor.render(i);this._editor.after("nodeChange",c.bind(this._onEditorChange,this));return f;},_initContent:function(f,j){var l=this.get("host"),h=this.get("editorClass")+"-place",m=l.one("."+h),e=this._editor.getInstance(),g=e.one("body"),i=null,k={};i=function(o,r){var s=c.Array.indexOf(["height","width"],o)!=-1,q=o.split("-"),p=c.Array.indexOf(q,"border")!=-1,n=c.Array.indexOf(q,"padding")!=-1;if(s||p||n){m.setStyle(c.Bewype.Utils.camelize(o),r);k[o]=r;}else{if(o){g.setStyle(c.Bewype.Utils.camelize(o),r);}}return r;};this._oMainCssdict.height="100%";this._oMainCssdict.width="100%";this._oMainCssdict.padding="0";this._oMainCssdict.margin="0";c.each(["iframe","html","body"],function(o,n){var p=l.one(o)||e.one(o);p.setStyle("cssText","padding: 0px; margin: 0px; height: 100%; width: 100%;");});c.JSON.stringify(j,c.bind(i,this));l.setStyle("cssText","");this._init(f,k);},initializer:function(f){var e=this._initEditor();this._editor.on("ready",c.bind(this._initContent,this,f,e));},destructor:function(){if(!this._editor){return;}var e=this.get("host"),h=this.get("editorClass"),g="."+h+"-place",k=e.one(g),i=this._editor.getInstance().one("body"),f=i.one(".selection"),j=null;this._editor.hide();if(f){f.replace(this.getInnerHTML(f));}e.set("innerHTML",i.get("innerHTML"));j=function(l,m,n){if(m){if(l==="content"&&(c.Array.indexOf(m.split("-"),"padding")!=-1||m==="height"||m==="width")){}else{e.setStyle(c.Bewype.Utils.camelize(m),n);}}return n;};c.JSON.stringify(c.Bewype.Utils.getCssDict(k),c.bind(j,this,"place"));c.JSON.stringify(c.Bewype.Utils.getCssDict(i),c.bind(j,this,"content"));this._editor.destroy();},updateStyle:function(g){var i=this.get("host"),l=c.Array.indexOf(["height","width"],g)!=-1,k=g.split("-"),e=c.Array.indexOf(k,"padding")!=-1,h=null,j=this._panel.getButton(g),f=j?j.getValue():null;if(l||e){h=i.one("."+this.get("editorClass")+"-place");}else{h=this._editor.getInstance().one("body");}h.setStyle(c.Bewype.Utils.camelize(g),f);},_clearSelection:function(h,f,e){if(h.clear){h.clear();}else{if(h.removeAllRanges){f.detach();h.removeAllRanges();}else{return;}}if(e!==false){var g=this._editor.getInstance(),i=g.one("body");this.removeTagOrStyle(i,".selection");}},_isFocusNodeFisrt:function(n){var g=this._editor.getInstance(),j=g.one("body")._node,k=n.anchorNode,p=n.focusNode,f=n.anchorOffset,o=n.focusOffset,l=j.innerHTML?j.innerHTML:j.textContent,m=k.innerHTML?k.innerHTML:k.textContent,e=p.innerHTML?p.innerHTML:p.textContent,i=0,h=0;if(k==p){return o<f;}else{i=c.Array.indexOf(l,m);h=c.Array.indexOf(l,e);return h<i;}},_ensureRangeFirstNode:function(h,e,l){var g=this._editor.getInstance(),f=g.one("body")._node,j=0,k=null;if(l.parentNode!=f){try{while(l.parentNode&&l.parentNode!=f){l=l.parentNode;j+=1;if(j==10){break;}}e.setStartBefore(l);}catch(i){k=i;return this._clearSelection(h,e);}}else{if(h.anchorOffset===0&&!h.anchorNode.previousSibling){e.setStart(f,0);}}return true;},_ensureRangeLastNode:function(h,e,k){var g=this._editor.getInstance(),f=g.one("body")._node,j=0,l=null;if(k.parentNode!=f){try{while(k.parentNode&&k.parentNode!=f){k=k.parentNode;j+=1;if(j==10){break;}}e.setEndAfter(k);}catch(i){l=i;return this._clearSelection(h,e);}}return true;},_refreshSelectionNode:function(){var e=this._editor.getInstance(),f=e.one(".selection"),g=this.get("selectionColor");if(!f){return;}f.setStyle("backgroundColor",g);f.setStyle("display","inline-block");},_updateSelection:function(){var k=this.get("host"),g=this._editor.getInstance(),h=g.one("body"),f=h.one(".selection"),l=c.Bewype.Utils.getSelection(k),j=c.Bewype.Utils.getRange(l),m=null,e=null;if(!l.anchorNode||!l.focusNode){return this._clearSelection(l,j);}if(f){f.replace(this.getInnerHTML(f));}if(l.anchorNode!=l.focusNode||l.anchorOffset!=l.focusOffset){if(this._isFocusNodeFisrt(l)){m=l.focusNode;e=l.anchorNode;}else{m=l.anchorNode;e=l.focusNode;}if(!this._ensureRangeFirstNode(l,j,m)){return;}if(!this._ensureRangeLastNode(l,j,e)){return;}try{f=c.Node.create('<span class="selection"></span>');h.append(f);j.surroundContents(h.one(".selection")._node);}catch(i){return this._clearSelection(l,j);}this._clearSelection(l,j,false);}else{this.removeTagOrStyle(h,".selection");}this._panel.refreshButtons(f);this._refreshSelectionNode();},_insertNodeToSelection:function(i){var f=this.get("host"),h=this._editor.getInstance(),k=h.one("body"),l=c.Bewype.Utils.getWindow(f),e=c.Bewype.Utils.getDocument(f),g=null,j=null;if(l._node.getSelection){g=l._node.getSelection();if(g.rangeCount>0){j=g.getRangeAt(0);k.append(i);j.insertNode(i._node);}}else{j=e._node.selection.createRange();j.collapse(true);j.pasteHTML(i._node);}},_onEditorChange:function(f){if(f.changedEvent.type==="dblclick"){}else{if(f.changedEvent.type==="mouseup"){this._updateSelection();}}},onButtonClick:function(f,i){var g=this._editor.getInstance(),h=g.one(".selection");this._panel.refreshButtons(h,false,f);},onButtonChange:function(f,l){var i=this._editor.getInstance(),j=i.one("body"),h=j.one(".selection"),o=this._panel.getButton(f),p=o?o.getValue():null,m=null,g=null,k=null,n=null;if(!h){if(this._panel.isCssButton(f)){this.updateStyle(f);return true;}else{if(f==="file"){m=c.Node.create(c.substitute(d,{filePath:this.get("fileStaticPath")+p.fileName}));this._insertNodeToSelection(m);return true;}else{if(f==="reset"){this.resetStyle(j);c.Bewype.Utils.setCssDict(j,this._oMainCssdict);return true;}}}}else{if(f==="file"){}else{g=this._panel.getWorkingTagName(f,true);
if(g){this.removeTagOrStyle(h,g,f);}g=this._panel.getWorkingTagName(f);if(g&&p&&(p===true||c.Bewype.Utils.trim(p)!=="")){if(f==="url"){k=c.Node.create('<a href="'+p+'"></a>');}else{k=c.Node.create("<"+g+"></"+g+">");}if(this._panel.isCssButton(f)){k.setStyle(c.Bewype.Utils.camelize(f),p);if(f==="background-color"){k.setStyle("display","inline-block");}}n=c.Node.create('<span class="selection"></span>');n.append(k);n.one(g).append(this.getInnerHTML(h));h.replace(n);}else{if(f==="reset"){this.resetStyle(h,true);this._panel.refreshButtons(h,true);}}this._refreshSelectionNode();return true;}}return false;},onSpinnerChange:function(f,e){var g=this.get("host"),h=this.get("editorClass")+"-place",i=g.one("."+h);return this._onSpinnerChange(i,f,e);}});c.augment(a,c.EventTarget);c.namespace("Bewype");c.Bewype.EditorText=a;},"@VERSION@",{requires:["bewype-editor-base","editor"]});