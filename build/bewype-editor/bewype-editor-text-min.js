YUI.add("bewype-editor-text",function(c){var b="",a=null;b+='<div class="{editorClass}-place">';b+="</div>";a=function(d){a.superclass.constructor.apply(this,arguments);};a.NAME="bewype-editor-text";a.NS="bewypeEditorText";a.ATTRS={};c.extend(a,c.Bewype.EditorBase,{_editor:null,_oMainCssdict:{},_initEditor:function(){var e=this.get("host"),f=this.get("editorClass"),d=c.Bewype.Utils.getCssDict(e),h=null,g=new c.Node.create('<div><div class="main" /></div>');g.one(".main").append(this.getInnerHTML(e));e.set("innerHTML","");h=new c.Node.create(c.substitute(b,{editorClass:f}));e.append(h);this._editor=new c.EditorBase({content:g.get("innerHTML")});this._editor.render(h);this._editor.after("nodeChange",c.bind(this._onEditorChange,this));return d;},_initContent:function(f){var e=this.get("host"),g=this.get("editorClass")+"-place",k=e.one("."+g),i=this._editor.getInstance().one("body"),h=i.one(".main"),j=null,d={};i.setStyle("cssText","padding: 0; margin: 0; height: 100%; width: 100%;");j=function(m,p){var q=["height","width"].indexOf(m)!=-1,o=m.split("-"),n=o.indexOf("border")!=-1,l=o.indexOf("padding")!=-1;if(q||n||l){k.setStyle(c.Bewype.Utils.camelize(m),p);d[m]=p;}else{if(m){h.setStyle(c.Bewype.Utils.camelize(m),p);}}return p;};this._oMainCssdict.height="100%";this._oMainCssdict.width="100%";h.setStyle("height","100%");h.setStyle("width","100%");c.JSON.stringify(f,c.bind(j,this));e.setStyle("cssText","");return d;},initializer:function(f){var e=this._initEditor(),d=this._initContent(e);this._init(f,d);},destructor:function(){if(!this._editor){return;}var d=this.get("host"),g=this.get("editorClass"),f="."+g+"-place",k=d.one(f),i=this._editor.getInstance().one("body"),h=i.one(".main"),e=h.one(".selection"),j=null;this._editor.hide();if(e){e.replace(this.getInnerHTML(e));}d.set("innerHTML",h.get("innerHTML"));j=function(l,m,n){if(m){if(l==="content"&&(m.split("-").indexOf("padding")!=-1||m==="height"||m==="width")){}else{d.setStyle(c.Bewype.Utils.camelize(m),n);}}return n;};c.JSON.stringify(c.Bewype.Utils.getCssDict(k),c.bind(j,this,"place"));c.JSON.stringify(c.Bewype.Utils.getCssDict(h),c.bind(j,this,"content"));this._editor.destroy();},updateStyle:function(f){var h=this.get("host"),k=["height","width"].indexOf(f)!=-1,j=f.split("-"),d=j.indexOf("padding")!=-1,g=null,i=this._panel.getButton(f),e=i?i.getValue():null;if(k||d){g=h.one("."+this.get("editorClass")+"-place");}else{g=this._editor.getInstance().one(".main");}g.setStyle(c.Bewype.Utils.camelize(f),e);},_clearSelection:function(g,e,d){if(g.clear){g.clear();}else{if(g.removeAllRanges){e.detach();g.removeAllRanges();}else{return;}}if(d!==false){var f=this._editor.getInstance(),h=f.one("body").one(".main");this.removeTagOrStyle(h,".selection");}},_isFocusNodeFisrt:function(m){var f=this._editor.getInstance(),i=f.one("body").one(".main")._node,j=m.anchorNode,o=m.focusNode,e=m.anchorOffset,n=m.focusOffset,k=i.innerHTML?i.innerHTML:i.textContent,l=j.innerHTML?j.innerHTML:j.textContent,d=o.innerHTML?o.innerHTML:o.textContent,h=0,g=0;if(j==o){return n<e;}else{h=k.indexOf(l);g=k.indexOf(d);return g<h;}},_ensureRangeFirstNode:function(g,d,j){var f=this._editor.getInstance(),k=f.one("body").one(".main"),e=k._node,i=0;if(j.parentNode!=e){try{while(j.parentNode&&j.parentNode!=e){j=j.parentNode;i+=1;if(i==10){break;}}d.setStartBefore(j);}catch(h){return this._clearSelection(g,d);}}else{if(g.anchorOffset===0&&!g.anchorNode.previousSibling){d.setStart(e,0);}}return true;},_ensureRangeLastNode:function(g,d,j){var f=this._editor.getInstance(),k=f.one("body").one(".main"),e=k._node,i=0;if(j.parentNode!=e){try{while(j.parentNode&&j.parentNode!=e){j=j.parentNode;i+=1;if(i==10){break;}}d.setEndAfter(j);}catch(h){return this._clearSelection(g,d);}}return true;},_refreshSelectionNode:function(){var d=this._editor.getInstance(),e=d.one(".selection"),f=this.get("selectionColor");if(!e){return;}e.setStyle("backgroundColor",f);e.setStyle("display","inline-block");},_updateSelection:function(){var k=this.get("host"),g=this._editor.getInstance(),h=g.one("body"),d=h.one(".main"),f=d.one(".selection"),l=c.Bewype.Utils.getSelection(k),j=c.Bewype.Utils.getRange(l),m=null,e=null;if(!l.anchorNode||!l.focusNode){return this._clearSelection(l,j);}if(f){f.replace(this.getInnerHTML(f));}if(l.anchorNode!=l.focusNode||l.anchorOffset!=l.focusOffset){if(this._isFocusNodeFisrt(l)){m=l.focusNode;e=l.anchorNode;}else{m=l.anchorNode;e=l.focusNode;}if(!this._ensureRangeFirstNode(l,j,m)){return;}if(!this._ensureRangeLastNode(l,j,e)){return;}try{f=c.Node.create('<span class="selection"></span>');d.append(f);j.surroundContents(d.one(".selection")._node);}catch(i){return this._clearSelection(l,j);}this._clearSelection(l,j,false);}else{this.removeTagOrStyle(d,".selection");}this._panel.refreshButtons(f);this._refreshSelectionNode();},_onEditorChange:function(d){if(d.changedEvent.type=="dblclick"){}else{if(d.changedEvent.type=="mouseup"){this._updateSelection();}}},onButtonClick:function(d,h){var f=this._editor.getInstance(),g=f.one(".selection");this._panel.refreshButtons(g,false,d);},onButtonChange:function(f,l){var i=this._editor.getInstance(),j=i.one("body"),d=j.one(".main"),h=d.one(".selection"),n=this._panel.getButton(f),o=n?n.getValue():null,g=null,k=null,m=null;if(!h){if(this._panel.isCssButton(f)){this.updateStyle(f);return true;}else{if(f==="reset"){this.resetStyle(d);c.Bewype.Utils.setCssDict(d,this._oMainCssdict);return true;}}}else{g=this._panel.getWorkingTagName(f,true);if(g){this.removeTagOrStyle(h,g,f);}g=this._panel.getWorkingTagName(f);if(o&&(o===true||o.trim()!=="")){if(f==="url"){k=c.Node.create('<a href="'+o+'"></a>');}else{k=c.Node.create("<"+g+"></"+g+">");}if(this._panel.isCssButton(f)){k.setStyle(c.Bewype.Utils.camelize(f),o);if(f==="background-color"){k.setStyle("display","inline-block");}}m=c.Node.create('<span class="selection"></span>');m.append(k);m.one(g).append(this.getInnerHTML(h));h.replace(m);}else{if(f==="reset"){this.resetStyle(h,true);this._panel.refreshButtons(h,true);
}}this._refreshSelectionNode();return true;}return false;},onSpinnerChange:function(e,d){var f=this.get("host"),g=this.get("editorClass")+"-place",h=f.one("."+g);return this._onSpinnerChange(h,e,d);}});c.augment(a,c.EventTarget);c.namespace("Bewype");c.Bewype.EditorText=a;},"@VERSION@",{requires:["bewype-editor-base","editor"]});