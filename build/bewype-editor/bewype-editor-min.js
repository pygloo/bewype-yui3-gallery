YUI.add("bewype-editor-config",function(b){var a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="bewype-editor-config";a.ATTRS={editorClass:{value:"bewype-editor-panel",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},activeButtons:{value:["height","width","padding-top","padding-right","padding-bottom","padding-left","bold","italic","underline","title","font-family","font-size","text-align","color","background-color","url","file","reset","apply"],writeOnce:true},spinnerLabelHeight:{value:"height",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},spinnerLabelWidth:{value:"width",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},spinnerMaxHeight:{value:480,writeOnce:true,validator:function(c){return b.Lang.isNumber(c);}},spinnerMaxWidth:{value:640,writeOnce:true,validator:function(c){return b.Lang.isNumber(c);}},spinnerLabelPaddingTop:{value:"padding-top",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},spinnerLabelPaddingRight:{value:"padding-right",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},spinnerLabelPaddingBottom:{value:"padding-bottom",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},spinnerLabelPaddingLeft:{value:"padding-left",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},fileStaticPath:{value:b.config.doc.location.href+"static/",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},uploadUrl:{value:b.config.doc.location.href+"upload",writeOnce:true},panelNode:{value:null,writeOnce:true},spinnerValues:{value:{}},selectionColor:{value:"#ddd",writeOnce:true,validator:function(c){return b.Lang.isString(c);}}};b.extend(a,b.Plugin.Base);b.namespace("Bewype");b.Bewype.EditorConfig=a;},"@VERSION@",{requires:["plugin"]});YUI.add("bewype-editor-panel",function(d){var b="",a="",c=null;b+='<div class="{editorClass} {buttonClass}">';b+="</div>";a+='<div class="{editorClass}">';a+="{label}";a+='<div class="{spinnerClass}"></div>';a+="</div>";c=function(e){c.superclass.constructor.apply(this,arguments);};c.NAME="bewype-editor-panel";c.NS="bewypeEditorPanel";d.extend(c,d.Bewype.EditorConfig,{_buttonDict:{},_editors:[],_spinnerButtons:["height","width","padding-top","padding-right","padding-bottom","padding-left"],_toggleButtons:["bold","italic","underline"],_pickerButtons:["title","font-family","font-size","text-align","color","background-color","url","file"],_pickerObjDict:{"background-color":d.Bewype.PickerColor,"color":d.Bewype.PickerColor,"file":d.Bewype.PickerFile,"font-family":d.Bewype.PickerFontFamily,"font-size":d.Bewype.PickerFontSize,"text-align":d.Bewype.PickerTextAlign,"title":d.Bewype.PickerTitle,"url":d.Bewype.PickerUrl},_tagButtons:["bold","italic","title","underline","url"],_cssButtons:["font-family","font-size","text-align","color","background-color"],_addSpinnerButton:function(e,f){var j=this.get("host"),i=this.get("editorClass")+"-button",g=this.get("editorClass")+"-spinner-"+e,l=null,k=null,h=f.spinnerValues[e],m=h?parseInt(h.replace(/px/i,""),10):0;l=new d.Node.create(d.substitute(a,{editorClass:i,label:this.get(d.Bewype.Utils.camelize("spinner-label-"+e)),spinnerClass:g}));j.append(l);k=new d.Bewype.EntrySpinner({srcNode:l.one("."+g),max:this.get(d.Bewype.Utils.camelize("spinner-max-"+e)),min:0,value:m});k.render();k.on("entry:onChange",d.bind(this._onSpinnerChange,this,e));this._buttonDict[e]=k;},__buttonFactory:function(g,f,j){var i=this.get("host"),k=this.get("editorClass"),l=null,e=null,h=null;l=new d.Node.create(d.substitute(b,{editorClass:k+"-button",buttonClass:k+"-button-"+g}));i.append(l);j.render(l);if(f==="button"){e="button:onClick";}else{e="button:onChange";}j.on(e,d.bind(this._onButtonChange,this,g));if(this._pickerButtons.indexOf(g)!=-1){h="button:onClick";j.before(h,d.bind(this._onButtonClick,this,g));}this._buttonDict[g]=j;},_addButton:function(e){var f=new d.Bewype.Button({label:e});this.__buttonFactory(e,"button",f);},_addToggleButton:function(e){var f=new d.Bewype.ButtonToggle({label:e});this.__buttonFactory(e,"toggle-button",f);},_addPickerButton:function(e,g){var f=new d.Bewype.ButtonPicker({label:e,pickerObj:g});this.__buttonFactory(e,"picker-button",f);},_initPanel:function(e){var f=this.get("activeButtons");d.Object.each(this._spinnerButtons,function(h,g){if(f.indexOf(h)!=-1){this._addSpinnerButton(h,e);}},this);this.updateSpinnerMaxWidth();d.Object.each(this._toggleButtons,function(h,g){if(f.indexOf(h)!=-1){this._addToggleButton(h);}},this);d.Object.each(this._pickerButtons,function(h,g){if(f.indexOf(h)!=-1){this._addPickerButton(h,this._pickerObjDict[h]);}},this);this._addButton("reset");this._addButton("apply");},initializer:function(e){this._initPanel(e);d.publish("bewype-editor:onClose");d.publish("bewype-editor:onChange");},destructor:function(){var e=this.get("host"),f=this.get("editorClass");d.Object.each(this.get("activeButtons"),function(h,g){this._buttonDict[h].destroy();delete (this._buttonDict[h]);},this);e.all("."+f+"-button").each(function(h,g){h.remove();});d.Object.each(this._editors,function(h,g){if(h.bewypeEditorTag){h.unplug(d.Bewype.EditorTag);}else{if(h.bewypeEditorText){h.unplug(d.Bewype.EditorText);}else{return;}}this.unRegisterEditor(h);},this);},registerEditor:function(e){if(this._editors.indexOf(e)==-1){this._editors.push(e);}},unRegisterEditor:function(e){var f=this._editors.indexOf(e);if(f!=-1){this._editors.splice(f,1);}},getWorkingTagName:function(f,g){switch(f){case"bold":return"b";case"italic":return"i";case"title":var h=this._buttonDict[f],e=g?h.getPrevious():h.getValue();return e==="normal"?null:e;case"underline":return"u";case"url":return"a";default:return"span";}},getButton:function(e){return this._buttonDict[e];},isCssButton:function(e){return this._cssButtons.indexOf(e)!=-1;},_getStyleValue:function(g,f){if(!g){return null;}else{if(f==="url"){return g.get("href");}else{var e=d.Bewype.Utils.getCssDict(g);return e[f];}}},refreshButtons:function(g,f,e){if(!g){return;
}var h=e?[e]:this.get("activeButtons");d.Object.each(h,function(l,j){if(this.get("activeButtons").indexOf(l)===-1){return;}var i=null;switch(l){case"bold":i=f?false:g.one("b")!==null;return this._buttonDict[l].setValue(i);case"italic":i=f?false:g.one("i")!==null;return this._buttonDict[l].setValue(i);case"underline":i=f?false:g.one("u")!==null;return this._buttonDict[l].setValue(i);case"file":this._buttonDict.height.setValue(g._node.height);this._buttonDict.width.setValue(g._node.width);return;case"font-family":case"font-size":case"color":case"background-color":i=f?false:this._getStyleValue(g,l);return this._buttonDict[l].setValue(i);case"url":i=f?false:this._getStyleValue(g,l);return this._buttonDict[l].setValue(i);}},this);},updateSpinnerMaxWidth:function(){var i=this.get("spinnerMaxWidth"),l=this._buttonDict["padding-left"],k=this._buttonDict["padding-right"],e=this._buttonDict.width,j=l?l.getValue():0,f=k?k.getValue():0,g=e?e.getValue():0,n=e?i-g-f:i,h=e?i-g-j:i,m=e?i-j-f:i;if(l){l.set("max",n);}if(e){e.set("max",m);}if(k){k.set("max",h);}return{"padding-left":n,"padding-right":h,"width":m};},_onButtonClick:function(f,h){var g=this.get("activeButtons");d.Object.each(this._pickerButtons,function(i,e){if(g.indexOf(i)!=-1&&i!=f){this._buttonDict[i].hidePicker();}},this);d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;e.onButtonClick(f,h);});},_onButtonChange:function(f,h){if(f==="apply"){this.get("host").unplug(d.Bewype.EditorPanel);return d.fire("bewype-editor:onClose");}var g=false;d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;g|=e.onButtonChange(f,h);});return g?d.fire("bewype-editor:onChange"):null;},_onSpinnerChange:function(f,h){var g=false;d.each(this._editors,function(j,i){var e=j.bewypeEditorTag||j.bewypeEditorText;g|=e.onSpinnerChange(f,h);});return g?d.fire("bewype-editor:onChange"):null;}});d.augment(c,d.EventTarget);d.namespace("Bewype");d.Bewype.EditorPanel=c;},"@VERSION@",{requires:["bewype-button","bewype-entry-spinner","bewype-utils","dataschema","event-custom","json-stringify","bewype-editor-config"]});YUI.add("bewype-editor-base",function(b){var a=null;a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="bewype-editor-base";b.extend(a,b.Bewype.EditorConfig,{_panel:null,_init:function(e,d){var c=this.get("panelNode");if(!c.bewypeEditorPanel){e.spinnerValues=d;c.plug(b.Bewype.EditorPanel,e);c.bewypeEditorPanel.registerEditor(this.get("host"));}this._panel=c.bewypeEditorPanel;},initializer:function(c){},destructor:function(){},_hasLeftBlank:function(c){if(c.length===0){return false;}else{if(c.substring(0,1).trim().length===0){return true;}}return false;},_hasRightBlank:function(c){if(c.length===0){return false;}else{if(c.substring(c.length-1,c.length).trim().length===0){return true;}}return false;},getInnerHTML:function(f,d){var e=f._node?f._node:f,c=e.innerHTML,g="";g+=this._hasLeftBlank(c)?"&nbsp;":"";g+=c.trim();g+=this._hasRightBlank(c)?"&nbsp;":"";return d?g:g.trim()===""?null:new b.Node.create(g);},removeTagOrStyle:function(d,c,e){if(d&&d._node.innerHTML){d.all(c).each(function(h,g){var i=null,f=null,j=null;if(e){i=b.Bewype.Utils.getCssDict(h);if(i[e]){delete (i[e]);if(e==="background-color"){delete (i.display);}}b.Bewype.Utils.setCssDict(h,i);j=b.Object.keys(i).length;if(j!==0){return;}}f=this.getInnerHTML(h);if(!f){h.remove();}else{h.replace(f);}},this);}},updateStyle:function(e,d){var f=this._panel.getButton(d),c=f?f.getValue():null;if(c){e.setStyle(b.Bewype.Utils.camelize(d),c);}},resetStyle:function(e,d){b.Object.each(["h1","h2","h3","h4","span","a","b","i","u"],function(g,f){this.removeTagOrStyle(e,g);},this);if(!d){var c=b.Bewype.Utils.getCssDict(e);b.Object.each(this._panel.get("activeButtons"),function(g,f){if(this._panel._cssButtons.indexOf(g)!=-1){delete (c[g]);}},this);b.Bewype.Utils.setCssDict(e,c);}},onButtonClick:function(c,d){},onButtonChange:function(c,d){return false;},_onSpinnerChange:function(g,c,k){var j=this._panel.getButton(c),i=b.Bewype.Utils.getCssDict(g),f=i[c],d=f?parseInt(f.replace(/px/i,""),10):0,e=j?j.getValue():0,h=(c==="padding-left"||c==="padding-right")?e/2:e,m=j?this._panel.updateSpinnerMaxWidth():0,l=m[c];if(!j){return false;}if(l&&h>l){j.setValue(d);return false;}else{g.setStyle(b.Bewype.Utils.camelize(c),e+"px");return true;}},onSpinnerChange:function(d,c){return false;}});b.namespace("Bewype");b.Bewype.EditorBase=a;},"@VERSION@",{requires:["bewype-editor-panel"]});YUI.add("bewype-editor-tag",function(b){var a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="bewype-editor-tag";a.NS="bewypeEditorTag";a.ATTRS={};b.extend(a,b.Bewype.EditorBase,{_initSpinnerValues:function(){var f=this.get("host"),d=b.Bewype.Utils.getCssDict(f),h=null,g=b.Bewype.Utils.getHeight(f)+"px",e=b.Bewype.Utils.getWidth(f)+"px",c={};if(!b.Object.hasKey(d,"height")){d.height=g;}if(!b.Object.hasKey(d,"width")){d.width=e;}h=function(j,o){var n=j==="height",k=j==="width",m=j.split("-"),l=m.indexOf("border")!=-1,i=m.indexOf("padding")!=-1;if(n||k||l||i){c[j]=o;}return o;};b.JSON.stringify(d,b.bind(h,this));return c;},initializer:function(d){var c=this._initSpinnerValues();this._init(d,c);},onButtonClick:function(c,d){this._panel.refreshButtons(this.get("host"),false,c);},onButtonChange:function(c,i){var j=this.get("host"),d=j.get("tagName"),k=this._panel.getButton(c),l=k?k.getValue():null,h=(c==="file")?(this.get("fileStaticPath")+l):null,f=null,g=null;switch(c){case"cancel":break;case"file":if(d&&d.toLowerCase()==="img"){j.setAttribute("src",h);j.setStyle("height","");j.setStyle("width","");this._panel.refreshButtons(j,false,c);return true;}return false;default:break;}f=this._panel.getWorkingTagName(c,true);if(f){this.removeTagOrStyle(j,f,c);}f=this._panel.getWorkingTagName(c);if(l&&(l===true||l.trim()!=="")){if(this._panel.isCssButton(c)){j.setStyle(b.Bewype.Utils.camelize(c),l);}else{if(c==="url"){g=b.Node.create('<a href="'+l+'"></a>');}else{g=b.Node.create("<"+f+"></"+f+">");
}g.append(this.getInnerHTML(j));j.setContent(g);}}else{if(c==="reset"){this.resetStyle(j);this._panel.refreshButtons(j,true);}}return true;},onSpinnerChange:function(d,c){return this._onSpinnerChange(this.get("host"),d,c);}});b.namespace("Bewype");b.Bewype.EditorTag=a;},"@VERSION@",{requires:["bewype-editor-base"]});YUI.add("bewype-editor-text",function(c){var b="",a=null;b+='<div class="{editorClass}-place">';b+="</div>";a=function(d){a.superclass.constructor.apply(this,arguments);};a.NAME="bewype-editor-text";a.NS="bewypeEditorText";a.ATTRS={};c.extend(a,c.Bewype.EditorBase,{_editor:null,_oMainCssdict:{},_initEditor:function(){var e=this.get("host"),f=this.get("editorClass"),d=c.Bewype.Utils.getCssDict(e),h=null,g=new c.Node.create('<div><div class="main" /></div>');g.one(".main").append(this.getInnerHTML(e));e.set("innerHTML","");h=new c.Node.create(c.substitute(b,{editorClass:f}));e.append(h);this._editor=new c.EditorBase({content:g.get("innerHTML")});this._editor.render(h);this._editor.after("nodeChange",c.bind(this._onEditorChange,this));return d;},_initContent:function(f){var e=this.get("host"),g=this.get("editorClass")+"-place",k=e.one("."+g),i=this._editor.getInstance().one("body"),h=i.one(".main"),j=null,d={};i.setStyle("cssText","padding: 0; margin: 0; height: 100%; width: 100%;");j=function(m,p){var q=["height","width"].indexOf(m)!=-1,o=m.split("-"),n=o.indexOf("border")!=-1,l=o.indexOf("padding")!=-1;if(q||n||l){k.setStyle(c.Bewype.Utils.camelize(m),p);d[m]=p;}else{if(m){h.setStyle(c.Bewype.Utils.camelize(m),p);}}return p;};this._oMainCssdict.height="100%";this._oMainCssdict.width="100%";h.setStyle("height","100%");h.setStyle("width","100%");c.JSON.stringify(f,c.bind(j,this));e.setStyle("cssText","");return d;},initializer:function(f){var e=this._initEditor(),d=this._initContent(e);this._init(f,d);},destructor:function(){if(!this._editor){return;}var d=this.get("host"),g=this.get("editorClass"),f="."+g+"-place",k=d.one(f),i=this._editor.getInstance().one("body"),h=i.one(".main"),e=h.one(".selection"),j=null;this._editor.hide();if(e){e.replace(this.getInnerHTML(e));}d.set("innerHTML",h.get("innerHTML"));j=function(l,m,n){if(m){if(l==="content"&&(m.split("-").indexOf("padding")!=-1||m==="height"||m==="width")){}else{d.setStyle(c.Bewype.Utils.camelize(m),n);}}return n;};c.JSON.stringify(c.Bewype.Utils.getCssDict(k),c.bind(j,this,"place"));c.JSON.stringify(c.Bewype.Utils.getCssDict(h),c.bind(j,this,"content"));this._editor.destroy();},updateStyle:function(f){var h=this.get("host"),k=["height","width"].indexOf(f)!=-1,j=f.split("-"),d=j.indexOf("padding")!=-1,g=null,i=this._panel.getButton(f),e=i?i.getValue():null;if(k||d){g=h.one("."+this.get("editorClass")+"-place");}else{g=this._editor.getInstance().one(".main");}g.setStyle(c.Bewype.Utils.camelize(f),e);},_clearSelection:function(g,e,d){if(g.clear){g.clear();}else{if(g.removeAllRanges){e.detach();g.removeAllRanges();}else{return;}}if(d!==false){var f=this._editor.getInstance(),h=f.one("body").one(".main");this.removeTagOrStyle(h,".selection");}},_isFocusNodeFisrt:function(m){var f=this._editor.getInstance(),i=f.one("body").one(".main")._node,j=m.anchorNode,o=m.focusNode,e=m.anchorOffset,n=m.focusOffset,k=i.innerHTML?i.innerHTML:i.textContent,l=j.innerHTML?j.innerHTML:j.textContent,d=o.innerHTML?o.innerHTML:o.textContent,h=0,g=0;if(j==o){return n<e;}else{h=k.indexOf(l);g=k.indexOf(d);return g<h;}},_ensureRangeFirstNode:function(g,d,j){var f=this._editor.getInstance(),k=f.one("body").one(".main"),e=k._node,i=0;if(j.parentNode!=e){try{while(j.parentNode&&j.parentNode!=e){j=j.parentNode;i+=1;if(i==10){break;}}d.setStartBefore(j);}catch(h){return this._clearSelection(g,d);}}else{if(g.anchorOffset===0&&!g.anchorNode.previousSibling){d.setStart(e,0);}}return true;},_ensureRangeLastNode:function(g,d,j){var f=this._editor.getInstance(),k=f.one("body").one(".main"),e=k._node,i=0;if(j.parentNode!=e){try{while(j.parentNode&&j.parentNode!=e){j=j.parentNode;i+=1;if(i==10){break;}}d.setEndAfter(j);}catch(h){return this._clearSelection(g,d);}}return true;},_refreshSelectionNode:function(){var d=this._editor.getInstance(),e=d.one(".selection"),f=this.get("selectionColor");if(!e){return;}e.setStyle("backgroundColor",f);e.setStyle("display","inline-block");},_updateSelection:function(){var k=this.get("host"),g=this._editor.getInstance(),h=g.one("body"),d=h.one(".main"),f=d.one(".selection"),l=c.Bewype.Utils.getSelection(k),j=c.Bewype.Utils.getRange(l),m=null,e=null;if(!l.anchorNode||!l.focusNode){return this._clearSelection(l,j);}if(f){f.replace(this.getInnerHTML(f));}if(l.anchorNode!=l.focusNode||l.anchorOffset!=l.focusOffset){if(this._isFocusNodeFisrt(l)){m=l.focusNode;e=l.anchorNode;}else{m=l.anchorNode;e=l.focusNode;}if(!this._ensureRangeFirstNode(l,j,m)){return;}if(!this._ensureRangeLastNode(l,j,e)){return;}try{f=c.Node.create('<span class="selection"></span>');d.append(f);j.surroundContents(d.one(".selection")._node);}catch(i){return this._clearSelection(l,j);}this._clearSelection(l,j,false);}else{this.removeTagOrStyle(d,".selection");}this._panel.refreshButtons(f);this._refreshSelectionNode();},_onEditorChange:function(d){if(d.changedEvent.type=="dblclick"){}else{if(d.changedEvent.type=="mouseup"){this._updateSelection();}}},onButtonClick:function(d,h){var f=this._editor.getInstance(),g=f.one(".selection");this._panel.refreshButtons(g,false,d);},onButtonChange:function(f,l){var i=this._editor.getInstance(),j=i.one("body"),d=j.one(".main"),h=d.one(".selection"),n=this._panel.getButton(f),o=n?n.getValue():null,g=null,k=null,m=null;if(!h){if(this._panel.isCssButton(f)){this.updateStyle(f);return true;}else{if(f==="reset"){this.resetStyle(d);c.Bewype.Utils.setCssDict(d,this._oMainCssdict);return true;}}}else{g=this._panel.getWorkingTagName(f,true);if(g){this.removeTagOrStyle(h,g,f);}g=this._panel.getWorkingTagName(f);if(o&&(o===true||o.trim()!=="")){if(f==="url"){k=c.Node.create('<a href="'+o+'"></a>');}else{k=c.Node.create("<"+g+"></"+g+">");}if(this._panel.isCssButton(f)){k.setStyle(c.Bewype.Utils.camelize(f),o);
if(f==="background-color"){k.setStyle("display","inline-block");}}m=c.Node.create('<span class="selection"></span>');m.append(k);m.one(g).append(this.getInnerHTML(h));h.replace(m);}else{if(f==="reset"){this.resetStyle(h,true);this._panel.refreshButtons(h,true);}}this._refreshSelectionNode();return true;}return false;},onSpinnerChange:function(e,d){var f=this.get("host"),g=this.get("editorClass")+"-place",h=f.one("."+g);return this._onSpinnerChange(h,e,d);}});c.augment(a,c.EventTarget);c.namespace("Bewype");c.Bewype.EditorText=a;},"@VERSION@",{requires:["bewype-editor-base","editor"]});YUI.add("bewype-editor",function(a){},"@VERSION@",{use:["bewype-editor-config","bewype-editor-panel","bewype-editor-base","bewype-editor-tag","bewype-editor-text"]});