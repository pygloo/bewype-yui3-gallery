YUI.add("bewype-layout-designer-places",function(b){var a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="layout-designer-places";a.NS="layoutDesignerPlaces";b.extend(a,b.Bewype.LayoutDesignerConfig,{placesNode:null,contents:null,sortable:null,_initSortable:function(){var f=this.get("host"),i=this.get("baseNode"),e=this.get("placesType"),g=i.one("."+this.get("designerClass")+"-sources"),h=g.layoutDesignerSources.sortable,d="."+this.get("designerClass")+"-content-clone-drag",c="."+this.get("designerClass")+"-places-grip";this.sortable=new b.Sortable({container:f,nodes:"li",opacity:".2",handles:e==="horizontal"?[d]:[c]});},initializer:function(c){this.setAttrs(c);var f=this.get("host"),e=this.get("designerClass"),d=this.get("placesType"),g="."+e+"-src",h=this.get("parentNode");this.contents=[];f.removeClass(e+"-src");f.removeClass(e+"-src-"+d);f.addClass(e+"-places");f.addClass(e+"-places-"+d);f.all(g).each(function(j,i){var l=this.getAttrs();l.parentNode=f;l.contentType=j.one("img")?"image":"text";j.plug(b.Bewype.LayoutDesignerContent,l);this.contents.push(j);},this);this._initSortable();if(h){this._addGripNode();}},destructor:function(){var c=this.get("host"),d=this.get("parentNode");b.Object.each(this.contents,function(f,e){if(f.layoutDesignerPlaces){f.unplug(b.Bewype.LayoutDesignerPlaces);}else{if(f.layoutDesignerContent){f.unplug(b.Bewype.LayoutDesignerContent);}else{}}},this);if(d){d.layoutDesignerPlaces.unRegisterContent(c);}},refresh:function(f,e){var d=this.get("host"),c=this.get("placesType"),h=this.getPlacesHeight(),j=this.getPlacesWidth(),i=this.get("parentNode"),g=null;h=h===0?this.get("contentHeight"):h;d.setStyle("height",h);d.setStyle("width",f||j);switch(c){case"vertical":if(e){g=f?f:j;}else{g=j>f?f:j;g=j===0?this.getAvailablePlace():j;}b.each(this.contents,function(n,m){var l=null;if(n.layoutDesignerPlaces){l=n.layoutDesignerPlaces.get("host");l.setStyle("width",g);if(f){n.layoutDesignerPlaces.refresh(g,e);}}else{if(f){n.layoutDesignerContent.refresh(g,e);}}});break;case"horizontal":g=f?(f/this.contents.length):null;b.Object.each(this.contents,function(n,m){var l=null,o=null;if(n.layoutDesignerContent){l=n.layoutDesignerContent.get("host");if(g){n.layoutDesignerContent.refresh(g,e);}}o=l?l.ancestor("li"):null;if(o){o.setStyle("height",h);o.setStyle("vertical-align","top");}},this);break;}return g;},_addGripNode:function(){var e=this.get("host"),d=e.ancestor("div"),c=this.get("designerClass")+"-places",f=new b.Node.create('<div class="'+c+'-grip" />');d.insertBefore(f,e);f.setStyle("bottom",0);f.setStyle("left",0);f.setStyle("position","absolute");},_getGripNode:function(){var e=this.get("host"),d=e.ancestor("div"),c=this.get("designerClass")+"-places";return d.one("div."+c+"-grip");},cleanContentOver:function(){b.each(this.contents,function(d,c){if(d.layoutDesignerContent){d.layoutDesignerContent._q.stop();d.layoutDesignerContent.hideClone();}});},getMaxWidth:function(){return b.Bewype.Utils.getWidth(this.get("host"));},hasPlace:function(d){var c=this.getAvailablePlace(),e=this.get("placesType");d=d?d:this.get("contentWidth");return e==="vertical"||c>=d;},hasSubPlaces:function(){var c=false;b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c=true;}});return c;},getAvailablePlace:function(){var d=this.get("placesType"),e=this.getMaxWidth(),c=this.getPlacesWidth();if(d==="vertical"){return c===0?e:c;}else{return e-c-2;}},getPlacesWidth:function(){var c=0,d=this.get("parentNode")||this.get("host");switch(this.get("placesType")){case"vertical":if(!this.get("parentNode")){return b.Bewype.Utils.getWidth(d);}b.each(this.contents,function(f,e){var g=0;if(f.layoutDesignerPlaces){g=f.layoutDesignerPlaces.getPlacesWidth();}else{if(f.layoutDesignerContent){g=f.layoutDesignerContent.getContentWidth();}}if(g>c){c=g;}});break;case"horizontal":b.each(this.contents,function(f,e){if(f.layoutDesignerPlaces){c+=f.layoutDesignerPlaces.getPlacesWidth();}else{if(f.layoutDesignerContent){c+=f.layoutDesignerContent.getContentWidth();}}});break;}return c;},getPlacesHeight:function(){var c=0;switch(this.get("placesType")){case"vertical":b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c+=e.layoutDesignerPlaces.getPlacesHeight();}else{if(e.layoutDesignerContent){c+=e.layoutDesignerContent.getContentHeight();}}});break;case"horizontal":b.each(this.contents,function(e,d){var f=0;if(e.layoutDesignerPlaces){f=e.layoutDesignerPlaces.getPlacesHeight();}else{if(e.layoutDesignerContent){f=e.layoutDesignerContent.getContentHeight();}}if(f>c){c=f;}});break;}return c;},registerContent:function(c){this.contents.push(c);},unRegisterContent:function(c){var d=this.contents.indexOf(c);if(d!=-1){this.contents.splice(d,1);}},getContents:function(){var c=[];b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c=c.concat(e.layoutDesignerPlaces.getContents());}else{c.push(e);}});return c;},removeContent:function(c,f){var j=c.ancestor("li"),e=this.get("host"),h=this.get("baseNode"),d=this.get("designerClass"),g=h.one("."+d+"-layout ul"),i=null;this.unRegisterContent(c);c.unplug(b.Bewype.LayoutDesignerContent);j.remove();if(this.contents.length===0&&e!=g){e.unplug(b.Bewype.LayoutDesignerPlaces);}else{if(e.layoutDesignerPlaces){i=this.getMaxWidth();this.refresh(i);}}}});b.namespace("Bewype");b.Bewype.LayoutDesignerPlaces=a;},"@VERSION@",{requires:["sortable","dd-constrain","bewype-layout-designer-content-text"]});