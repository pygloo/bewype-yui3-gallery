YUI.add("bewype-layout-designer-places",function(b){var a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="layout-designer-places";a.NS="layoutDesignerPlaces";a.H_PLACES_TEMPLATE='<table class="{designerClass}-places ';a.H_PLACES_TEMPLATE+="{designerClass}-places-horizontal ";a.H_PLACES_TEMPLATE+='{designerClass}-places-{placesLevel}">';a.H_PLACES_TEMPLATE+="<tr />";a.H_PLACES_TEMPLATE+="</table>";a.V_PLACES_TEMPLATE='<ul class="{designerClass}-places ';a.V_PLACES_TEMPLATE+="{designerClass}-places-vertical ";a.V_PLACES_TEMPLATE+='{designerClass}-places-{placesLevel}"></ul>';a.H_DEST_TEMPLATE='<td class="{designerClass}-cell ';a.H_DEST_TEMPLATE+="{designerClass}-cell-horizontal ";a.H_DEST_TEMPLATE+='{designerClass}-cell-{placesLevel}">';a.H_DEST_TEMPLATE+='<div class="{designerClass}-container"></div>';a.H_DEST_TEMPLATE+="</td>";a.V_DEST_TEMPLATE='<li class="{designerClass}-cell ';a.V_DEST_TEMPLATE+="{designerClass}-cell-vertical ";a.V_DEST_TEMPLATE+='{designerClass}-cell-{placesLevel}">';a.V_DEST_TEMPLATE+='<div class="{designerClass}-container"></div>';a.V_DEST_TEMPLATE+="</li>";b.extend(a,b.Bewype.LayoutDesignerConfig,{placesNode:null,contents:null,level:null,initializer:function(e){this.setAttrs(e);var k=this.get("host"),h=k.get("children"),d=this.get("placesType"),o=this.get("designerClass"),f=a.H_PLACES_TEMPLATE,c=a.V_PLACES_TEMPLATE,n=d==="horizontal"?f:c,m=this.get("parentNode"),g=null,j=null,l=null,i=null;this.contents=[];this.level=this._getPlacesLevel();this.placesNode=h?h.item(0):null;if(this.placesNode){if(this.placesNode.hasClass(o+"-places-vertical")){this._tableToUl();d="vertical";i="horizontal";}else{d="horizontal";i="vertical";}j=this.getAttrs();j.parentNode=k;if(d==="horizontal"){l=this.placesNode.one("tr").get("children");}else{g=this.placesNode.get("children").item(0);if(g.get("tagName").toLowerCase()!=="tbody"){g=this.placesNode;}l=g.get("children");}l.each(function(r,q){var s=r.get("children").item("0"),p=s?s.get("children").item("0"):null;if(!s){return;}if(p.get("tagName").toLowerCase()==="table"){j.targetType=i;s.plug(b.Bewype.LayoutDesignerTarget,j);j.targetType=null;j.placesType=i;s.plug(b.Bewype.LayoutDesignerPlaces,j);}else{j.contentType=p.hasClass(o+"-content-text")?"text":"image";s.plug(b.Bewype.LayoutDesignerContent,j);}this.registerContent(s);},this);}else{this.placesNode=new b.Node.create(b.substitute(n,{designerClass:o,placesLevel:this.level}));k.append(this.placesNode);this.placesNode.setStyle("height",this.get("contentHeight"));this.placesNode.setStyle("width",this.get("contentWidth"));}this._initSortable();},_getPlacesLevel:function(){var d=this.get("host"),c=this.get("designerClass"),f=d.ancestor("."+c+"-places"),e=0;while(f){f=f.ancestor("."+c+"-places");e+=1;}return"level"+e;},_initSortable:function(){var l=this.get("host"),f=this.get("placesType"),n=this.get("designerClass"),h=f==="horizontal"?"td":"li",m=f==="horizontal"?"table":"ul",g="."+n+"-layout",i="."+n+"-content-clone-drag",j=b.Sortable.getSortable(this.placesNode),k=l.ancestor(g),e=k?k.all(m):null,c=n+"-cell-"+this.level,d=n+"-places-"+this.level;if(j){b.Sortable.unreg(j);}j=new b.Sortable({container:this.placesNode,nodes:h+"."+c,opacity:".2",handles:[i]});if(!e){return;}e.each(function(p,o){if(this.placesNode!=p&&p.hasClass(d)){var q=b.Sortable.getSortable(p);if(q){q.join(j,"full");}}},this);},_tableToUl:function(){var e=b.Node.create("<ul />"),c=this.get("designerClass"),d=this.placesNode.get("children").item(0);if(d.get("tagName").toLowerCase()!=="tbody"){d=this.placesNode;}e.addClass(c+"-places");e.addClass(c+"-places-vertical");e.addClass(c+"-places-"+this.level);d.get("children").each(function(g,f){var i=b.Node.create("<li />"),h=g.one("td");i.addClass(c+"-cell");i.addClass(c+"-cell-vertical");i.addClass(c+"-cell-"+this.level);if(h){i.set("innerHTML",h.get("innerHTML"));}e.append(i);},this);this.placesNode.replace(e);this.placesNode=e;},_ulToTable:function(){var c=b.Node.create("<table />"),d=this.get("designerClass");c.addClass(d+"-places");c.addClass(d+"-places-vertical");c.addClass(d+"-places-"+this.level);this.placesNode.get("children").each(function(f,e){var h=b.Node.create("<tr />"),g=b.Node.create("<td />");g.addClass(d+"-cell");g.addClass(d+"-cell-vertical");g.addClass(d+"-cell-"+this.level);g.set("innerHTML",f.get("innerHTML"));h.append(g);c.append(h);},this);this.placesNode.replace(c);this.placesNode=c;},destructor:function(){var c=b.Sortable.getSortable(this.placesNode),d=this.get("placesType");b.Object.each(this.contents,function(f,e){if(f.layoutDesignerTarget){f.unplug(b.Bewype.LayoutDesignerTarget);}else{if(f.layoutDesignerContent){f.unplug(b.Bewype.LayoutDesignerContent);}else{}}},this);b.Sortable.unreg(c);if(d==="vertical"){this._ulToTable();}},hasSubPlaces:function(){var c=false;b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c=true;}});return c;},getMaxWidth:function(){return b.Bewype.Utils.getWidth(this.get("host"));},getAvailablePlace:function(){var d=this.get("placesType"),e=this.getMaxWidth(),c=this.getPlacesWidth();if(d==="vertical"){return c===0?e:c;}else{return e-c;}},hasPlace:function(d){var c=this.getAvailablePlace(),e=this.get("placesType");d=d?d:this.get("contentWidth");return e==="vertical"||c>=d;},getPlacesWidth:function(){var c=0,d=this.get("parentNode")||this.placesNode.ancestor("div");switch(this.get("placesType")){case"vertical":if(!this.get("parentNode")){return b.Bewype.Utils.getWidth(d);}b.each(this.contents,function(f,e){var g=0;if(f.layoutDesignerPlaces){g=f.layoutDesignerPlaces.getPlacesWidth();}else{g=f.layoutDesignerContent.getContentWidth();}if(g>c){c=g;}});break;case"horizontal":b.each(this.contents,function(f,e){if(f.layoutDesignerPlaces){c+=f.layoutDesignerPlaces.getPlacesWidth();}else{c+=f.layoutDesignerContent.getContentWidth();}});break;}return c;},getPlacesHeight:function(){var c=0;switch(this.get("placesType")){case"vertical":b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c+=e.layoutDesignerPlaces.getPlacesHeight();
}else{c+=e.layoutDesignerContent.getContentHeight();}});break;case"horizontal":b.each(this.contents,function(e,d){var f=0;if(e.layoutDesignerPlaces){f=e.layoutDesignerPlaces.getPlacesHeight();}else{f=e.layoutDesignerContent.getContentHeight();}if(f>c){c=f;}});c=(c===0)?this.get("contentHeight"):c;break;}return c;},refresh:function(d){var c=this.get("placesType"),e=this.getPlacesHeight(),g=d?d:this.getPlacesWidth(),f=this.get("parentNode");e=e===0?this.get("contentHeight"):e;g=g===0?this.getAvailablePlace():g;this.placesNode.setStyle("height",e);this.placesNode.setStyle("width",g);switch(c){case"vertical":b.each(this.contents,function(j,i){var h=null;if(j.layoutDesignerPlaces){h=j.layoutDesignerPlaces.placesNode;h.setStyle("width",g);if(d){j.layoutDesignerTarget.refresh(d);}}else{if(d){j.layoutDesignerContent.refresh(d);}}});break;case"horizontal":b.Object.each(this.contents,function(j,i){var h=null,m=d?(d/this.contents.length):null,l=null;if(j.layoutDesignerPlaces){h=j.layoutDesignerPlaces.placesNode;if(m){j.layoutDesignerTarget.refresh(m);}}else{if(j.layoutDesignerContent){h=j.layoutDesignerContent.get("host");if(m){j.layoutDesignerContent.refresh(m);}}}l=h?h.ancestor("td"):null;if(l){l.setStyle("height",e);l.setStyle("vertical-align","top");}},this);break;}if(!f){this.placesNode.ancestor("div").setStyle("height",e);}return[e,g];},cleanContentOver:function(){b.each(this.contents,function(d,c){if(d.layoutDesignerContent){d.layoutDesignerContent._q.stop();d.layoutDesignerContent.hideClone();}});},addDestNode:function(){var c=null;switch(this.get("placesType")){case"horizontal":c=new b.Node.create(b.substitute(a.H_DEST_TEMPLATE,{designerClass:this.get("designerClass"),placesLevel:this.level}));this.placesNode.one("tr").append(c);break;case"vertical":c=new b.Node.create(b.substitute(a.V_DEST_TEMPLATE,{designerClass:this.get("designerClass"),placesLevel:this.level}));this.placesNode.append(c);break;}return c.one("div");},registerContent:function(c){this.contents.push(c);this._initSortable();},unRegisterContent:function(c){var d=this.contents.indexOf(c);if(d!=-1){this.contents.splice(d,1);}},addContent:function(g){var c=this.get("placesType"),f=this.addDestNode(),e=this.getAttrs(),d=this.getMaxWidth();e.contentType=g;e.parentNode=this.get("host");e.contentWidth=c==="vertical"?d:this.getAvailablePlace();f.plug(b.Bewype.LayoutDesignerContent,e);this.registerContent(f);},removeContent:function(c,e){var f=null,d=this.get("host");switch(this.get("placesType")){case"horizontal":f=c.ancestor("td");break;case"vertical":f=c.ancestor("li");break;}this.unRegisterContent(c);c.unplug(b.Bewype.LayoutDesignerContent);f.remove(true);if(d.layoutDesignerTarget){d.layoutDesignerTarget.refresh(this.getMaxWidth());}},getContents:function(){var c=[];b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c=c.concat(e.layoutDesignerPlaces.getContents());}else{c.push(e);}});return c;}});b.namespace("Bewype");b.Bewype.LayoutDesignerPlaces=a;},"@VERSION@",{requires:["sortable","dd-constrain","bewype-layout-designer-content"]});