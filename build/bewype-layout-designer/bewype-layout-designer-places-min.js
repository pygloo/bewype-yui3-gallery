YUI.add("bewype-layout-designer-places",function(B){var A=function(C){A.superclass.constructor.apply(this,arguments);};A.NAME="layout-designer-places";A.NS="layoutDesignerPlaces";A.H_PLACES_TEMPLATE='<table class="{designerClass}-places {designerClass}-places-horizontal">';A.H_PLACES_TEMPLATE+="<tr />";A.H_PLACES_TEMPLATE+="</table>";A.V_PLACES_TEMPLATE='<ul class="{designerClass}-places {designerClass}-places-vertical"></ul>';A.H_DEST_TEMPLATE='<td class="{designerClass}-cell {designerClass}-cell-horizontal">';A.H_DEST_TEMPLATE+='<div class="{designerClass}-container"></div>';A.H_DEST_TEMPLATE+="</td>";A.V_DEST_TEMPLATE='<li class="{designerClass}-cell {designerClass}-cell-vertical">';A.V_DEST_TEMPLATE+='<div class="{designerClass}-container"></div>';A.V_DEST_TEMPLATE+="</li>";B.extend(A,B.Bewype.LayoutDesignerConfig,{placesNode:null,contents:null,initializer:function(F){this.setAttrs(F);var K=this.get("host"),G=K.get("children"),E=this.get("placesType"),O=this.get("designerClass"),H=A.H_PLACES_TEMPLATE,D=A.V_PLACES_TEMPLATE,M=E==="horizontal"?H:D,L=this.get("parentNode"),N=null,J=null,I=null,C=null;this.contents=[];this.placesNode=G?G.item(0):null;if(this.placesNode){if(this.placesNode.hasClass("."+O+"-places-vertical")){this._tableToUl();N="li";I="horizontal";}else{N="td";I="vertical";}J=this.getAttrs();J.parentNode=K;this.placesNode.all(N).each(function(R,Q){var P=R.get("children").item(0);if(P.get("tagName").toLowerCase()==="table"){J.targetType=I;P.plug(B.Bewype.LayoutDesignerTarget,J);J.targetType=null;J.placesType=I;P.plug(B.Bewype.LayoutDesignerPlaces,J);}else{J.contentType=P.one("."+O+"-content-text")?"text":"image";P.plug(B.Bewype.LayoutDesignerContent,J);}this.registerContent(P);},this);}else{this.placesNode=new B.Node.create(B.substitute(M,{designerClass:O}));K.append(this.placesNode);this.placesNode.setStyle("height",this.get("contentHeight"));this.placesNode.setStyle("width",this.get("contentWidth"));}this._initSortable();if(L&&L.layoutDesignerPlaces){L.layoutDesignerPlaces.registerContent(K);}},_initSortable:function(){var J=this.get("host"),D=this.get("placesType"),L=this.get("designerClass"),F=D==="horizontal"?"td":"li",K=D==="horizontal"?"table":"ul",E="."+L+"-layout",G="."+L+"-content-clone-drag",H=B.Sortable.getSortable(this.placesNode),I=J.ancestor(E),C=I?I.all(K):null;if(H){H.destroy();}H=new B.Sortable({container:this.placesNode,nodes:F,opacity:".2",handles:[G]});if(!C){return;}C.each(function(N,M){if(this.placesNode!=N){var O=B.Sortable.getSortable(N);O.join(H,"full");}},this);},_tableToUl:function(){var D=B.Node.create("<ul />"),C=this.get("designerClass");this.placesNode.all("td").each(function(F,E){var G=B.Node.create("<li />");G.addClass(C+"-cell");G.addClass(C+"-cell-vertical");G.set("innerHTML",F.get("innerHTML"));D.append(G);});this.placesNode.replace(D);},_ulToTable:function(){var C=B.Node.create("<table />"),D=this.get("designerClass");C.addClass(D+"-places");C.addClass(D+"-places-vertical");this.placesNode.all("li").each(function(F,E){var H=B.Node.create("<tr />"),G=B.Node.create("<td />");G.addClass(D+"-cell");G.addClass(D+"-cell-vertical");G.set("innerHTML",F.get("innerHTML"));H.append(G);C.append(H);});this.placesNode.replace(C);},destructor:function(){var C=B.Sortable.getSortable(this.placesNode);B.Object.each(this.contents,function(E,D){if(E.layoutDesignerTarget){E.unplug(B.Bewype.LayoutDesignerTarget);}else{if(E.layoutDesignerContent){E.unplug(B.Bewype.LayoutDesignerContent);}else{}}},this);C.destroy();this._ulToTable();},hasSubPlaces:function(){var C=false;B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C=true;}});return C;},getMaxWidth:function(){return B.Bewype.Utils.getWidth(this.get("host"));},getAvailablePlace:function(){var D=this.get("placesType"),E=this.getMaxWidth(),C=this.getPlacesWidth();if(D==="vertical"){return C===0?E:C;}else{return E-C;}},hasPlace:function(D){var C=this.getAvailablePlace(),E=this.get("placesType");D=D?D:this.get("contentWidth");return E==="vertical"||C>=D;},getPlacesWidth:function(){var C=0,D=this.get("parentNode")||this.placesNode.ancestor("div");switch(this.get("placesType")){case"vertical":if(!this.get("parentNode")){return B.Bewype.Utils.getWidth(D);}B.each(this.contents,function(F,E){var G=0;if(F.layoutDesignerPlaces){G=F.layoutDesignerPlaces.getPlacesWidth();}else{G=F.layoutDesignerContent.getContentWidth();}if(G>C){C=G;}});break;case"horizontal":B.each(this.contents,function(F,E){if(F.layoutDesignerPlaces){C+=F.layoutDesignerPlaces.getPlacesWidth();}else{C+=F.layoutDesignerContent.getContentWidth();}});break;}return C;},getPlacesHeight:function(){var C=0;switch(this.get("placesType")){case"vertical":B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C+=E.layoutDesignerPlaces.getPlacesHeight();}else{C+=E.layoutDesignerContent.getContentHeight();}});break;case"horizontal":B.each(this.contents,function(E,D){var F=0;if(E.layoutDesignerPlaces){F=E.layoutDesignerPlaces.getPlacesHeight();}else{F=E.layoutDesignerContent.getContentHeight();}if(F>C){C=F;}});C=(C===0)?this.get("contentHeight"):C;break;}return C;},refresh:function(D){var C=this.get("placesType"),E=this.getPlacesHeight(),G=D?D:this.getPlacesWidth(),F=this.get("parentNode");E=E===0?this.get("contentHeight"):E;G=G===0?this.getAvailablePlace():G;this.placesNode.setStyle("height",E);this.placesNode.setStyle("width",G);switch(C){case"vertical":B.each(this.contents,function(J,I){var H=null;if(J.layoutDesignerPlaces){H=J.layoutDesignerPlaces.placesNode;H.setStyle("width",G);if(D){J.layoutDesignerTarget.refresh(D);}}else{if(D){J.layoutDesignerContent.refresh(D);}}});break;case"horizontal":B.Object.each(this.contents,function(J,I){var H=null,L=D?(D/this.contents.length):null,K=null;if(J.layoutDesignerPlaces){H=J.layoutDesignerPlaces.placesNode;if(L){J.layoutDesignerTarget.refresh(L);}}else{if(J.layoutDesignerContent){H=J.layoutDesignerContent.get("host");if(L){J.layoutDesignerContent.refresh(L);}}}K=H?H.ancestor("td"):null;if(K){K.setStyle("height",E);
K.setStyle("vertical-align","top");}},this);break;}if(!F){this.placesNode.ancestor("div").setStyle("height",E);}return[E,G];},cleanContentOver:function(){B.each(this.contents,function(D,C){if(D.layoutDesignerContent){D.layoutDesignerContent._q.stop();D.layoutDesignerContent.hideClone();}});},addDestNode:function(){var C=null;switch(this.get("placesType")){case"horizontal":C=new B.Node.create(B.substitute(A.H_DEST_TEMPLATE,{designerClass:this.get("designerClass")}));this.placesNode.one("tr").append(C);break;case"vertical":C=new B.Node.create(B.substitute(A.V_DEST_TEMPLATE,{designerClass:this.get("designerClass")}));this.placesNode.append(C);break;}return C.one("div");},registerContent:function(C){this.contents.push(C);},unRegisterContent:function(C){var D=this.contents.indexOf(C);if(D!=-1){this.contents.splice(D,1);}},addContent:function(G){var C=this.get("placesType"),F=this.addDestNode(),E=this.getAttrs(),D=this.getMaxWidth();E.contentType=G;E.parentNode=this.get("host");E.contentWidth=C==="vertical"?D:this.getAvailablePlace();F.plug(B.Bewype.LayoutDesignerContent,E);this.registerContent(F);return D;},removeContent:function(C,E){var F=null,D=this.get("host");switch(this.get("placesType")){case"horizontal":F=C.ancestor("td");break;case"vertical":F=C.ancestor("li");break;}this.unRegisterContent(C);C.unplug(B.Bewype.LayoutDesignerContent);F.remove(true);if(D.layoutDesignerTarget){D.layoutDesignerTarget.refresh();}},getContents:function(){var C=[];B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C=C.concat(E.layoutDesignerPlaces.getContents());}else{C.push(E);}});return C;}});B.namespace("Bewype");B.Bewype.LayoutDesignerPlaces=A;},"@VERSION@",{requires:["sortable","dd-constrain","bewype-layout-designer-content"]});