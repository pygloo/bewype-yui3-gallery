YUI.add("bewype-layout-designer-places",function(B){var A=function(C){A.superclass.constructor.apply(this,arguments);};A.NAME="layout-designer-places";A.NS="layoutDesignerPlaces";A.H_PLACES_TEMPLATE='<table class="{placesClass}-horizontal">';A.H_PLACES_TEMPLATE+="<tr />";A.H_PLACES_TEMPLATE+="</table>";A.V_PLACES_TEMPLATE='<table class="{placesClass}-vertical"></table>';A.C_TEMPLATE='<div class="{contentClass}">{defaultContent}</div>';A.H_DEST_TEMPLATE='<td class="{destClass}-horizontal"><div class="container-{destClass}"></div></td>';A.V_DEST_TEMPLATE='<tr class="{destClass}-vertical">';A.V_DEST_TEMPLATE+="<td>";A.V_DEST_TEMPLATE+='<div class="container-{destClass}"></div>';A.V_DEST_TEMPLATE+="</td>";A.V_DEST_TEMPLATE+="</tr>";A.ATTRS={contentHeight:{value:40,validator:function(C){return B.Lang.isNumber(C);}},contentWidth:{value:140,validator:function(C){return B.Lang.isNumber(C);}},placesType:{value:"vertical",writeOnce:true,validator:function(C){return B.Lang.isString(C);}},placesClass:{value:"places",writeOnce:true,validator:function(C){return B.Lang.isString(C);}},destClass:{value:"dest",writeOnce:true,validator:function(C){return B.Lang.isString(C);}},contentClass:{value:"content",writeOnce:true,validator:function(C){return B.Lang.isString(C);}},defaultContent:{value:"Click to change your content..",validator:function(C){return B.Lang.isString(C);}},parentNode:{value:null,writeOnce:true},editPanelNode:{value:null,writeOnce:true}};B.extend(A,B.Plugin.Base,{placesNode:null,contents:null,sortable:null,initializer:function(D){var F=this.get("host"),E=this.get("placesType"),C=A.H_PLACES_TEMPLATE,H=A.V_PLACES_TEMPLATE,I=(E==="horizontal")?C:H,G=this.get("parentNode");this.placesNode=new B.Node.create(B.substitute(I,{placesClass:this.get("placesClass")}));F.append(this.placesNode);this.placesNode.setStyle("height",this.get("contentHeight"));this.placesNode.setStyle("width",this.get("contentWidth"));this._initSortable();if(G){G.layoutDesignerPlaces.registerContent(F);}else{B.DD.DDM.on("drag:enter",this._onEnterGotcha);}this.contents=[];},_initSortable:function(){var C=this.get("placesType"),D=(C==="horizontal")?"td":"tr";if(this.sortable){this.sortable.destroy();}this.sortable=new B.Sortable({container:this.placesNode,nodes:D,opacity:".2"});},_onEnterGotcha:function(M){var F=M.drag,H=M.drag.get("node"),C=H.one("div.content"),L=M.drop.get("node"),G=L.ancestor("div"),J=C?C.layoutDesignerContent:null,D=G.layoutDesignerPlaces,K=null,I=null,E=null,O=null,N=null;if(J&&D.get("placesType")==="vertical"&&D.contents.indexOf(C)==-1){K=C.layoutDesignerContent.get("parentNode");I=C.get("innerHTML");E=C.getStyle("cssText");O=C.ancestor("td");if(O.drop){C.unplug(B.Bewype.LayoutDesignerContent);O.drop.removeFromGroup(K.layoutDesignerPlaces.sortable);O.remove();N=K.layoutDesignerPlaces.addContent();N.set("innerHTML",I);N.setStyle("cssText",E);K.layoutDesignerTarget.refresh();F.removeFromGroup(K.layoutDesignerPlaces.sortable);F.stopDrag();F.end();F.destroy();M.stopPropagation();}}},destructor:function(){var C=this.get("host"),D=this.get("parentNode");B.Object.each(this.contents,function(F,E){if(F.layoutDesignerPlaces){F.layoutDesignerPlaces.destroy();}else{this.removeContent(F);}},this);if(D){D.layoutDesignerPlaces.unRegisterContent(C);}this.placesNode.remove();},hasSubPlaces:function(){var C=false;B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C=true;}});return C;},getAvailablePlace:function(){var E=this.get("parentNode")||this.placesNode.ancestor("div"),C=null,D=null;switch(this.get("placesType")){case"vertical":return null;case"horizontal":C=B.Bewype.Utils.getWidth(E);D=this.getPlacesWidth();return C-D;}},hasPlace:function(){var E=this.get("parentNode")||this.placesNode.ancestor("div"),C=null,D=null;switch(this.get("placesType")){case"vertical":return true;case"horizontal":C=B.Bewype.Utils.getWidth(E);D=this.getPlacesWidth();return C>=(D+this.get("contentWidth"));}},getPlacesWidth:function(){var C=0;switch(this.get("placesType")){case"vertical":B.each(this.contents,function(E,D){var F=0;if(E.layoutDesignerPlaces){F=E.layoutDesignerPlaces.getPlacesWidth();}else{F=E.layoutDesignerContent.getContentWidth();}if(F>C){C=F;}});break;case"horizontal":B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C+=E.layoutDesignerPlaces.getPlacesWidth();}else{C+=E.layoutDesignerContent.getContentWidth();}});break;}return(C===0)?this.get("contentWidth"):C;},getPlacesHeight:function(){var C=0;switch(this.get("placesType")){case"vertical":B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C+=E.layoutDesignerPlaces.getPlacesHeight();}else{C+=E.layoutDesignerContent.getContentHeight();}});break;case"horizontal":B.each(this.contents,function(E,D){var F=0;if(E.layoutDesignerPlaces){F=E.layoutDesignerPlaces.getPlacesHeight();}else{F=E.layoutDesignerContent.getContentHeight();}if(F>C){C=F;}});break;}return(C===0)?this.get("contentHeight"):C;},refresh:function(C){var D=this.get("placesType"),E=this.getPlacesHeight(),G=this.getPlacesWidth(),F=this.get("parentNode");this.placesNode.setStyle("height",E);this.placesNode.setStyle("width",G);switch(D){case"vertical":B.each(this.contents,function(J,I){var H=null;if(J.layoutDesignerPlaces){H=J.layoutDesignerPlaces.placesNode;H.setStyle("width",G);}});break;case"horizontal":B.each(this.contents,function(J,I){var H=null;if(J.layoutDesignerPlaces){H=J.layoutDesignerPlaces.placesNode;}else{H=J.layoutDesignerContent.get("host");}H.ancestor("td").setStyle("height",E);H.ancestor("td").setStyle("vertical-align","top");});break;}if(!C){if(F){F.layoutDesignerTarget.refresh();}else{this.placesNode.ancestor("div").setStyle("height",E);}}return[E,G];},cleanContentOver:function(){B.each(this.contents,function(D,C){if(D.layoutDesignerContent){D.layoutDesignerContent._q.stop();D.layoutDesignerContent.hideClone();}});},addDestNode:function(){if(!this.hasPlace()){return null;}var D=null,C=this.placesNode.one("tr");switch(this.get("placesType")){case"horizontal":D=new B.Node.create(B.substitute(A.H_DEST_TEMPLATE,{destClass:this.get("destClass")}));
C.append(D);break;case"vertical":D=new B.Node.create(B.substitute(A.V_DEST_TEMPLATE,{destClass:this.get("destClass")}));this.placesNode.append(D);break;}return D.one("div");},registerContent:function(C){this.contents.push(C);},unRegisterContent:function(C){var D=this.contents.indexOf(C);this.contents.splice(D,1);},addContent:function(){if(!this.hasPlace()){return null;}var D=this.addDestNode(),C=new B.Node.create(B.substitute(A.C_TEMPLATE,{contentClass:this.get("contentClass")}));D.append(C);C.plug(B.Bewype.LayoutDesignerContent,{contentHeight:this.get("contentHeight"),contentWidth:this.get("contentWidth"),contentZIndex:this.get("contentZIndex"),contentClass:this.get("contentClass"),defaultContent:this.get("defaultContent"),parentNode:this.get("host"),editPanelNode:this.get("editPanelNode")});return C;},removeContent:function(C){var E=null,D=this.get("host");switch(this.get("placesType")){case"horizontal":E=C.ancestor("td");break;case"vertical":E=C.ancestor("tr");break;}this.unRegisterContent(C);E.remove();D.layoutDesignerTarget.refresh();},getContents:function(){var C=[];B.each(this.contents,function(E,D){if(E.layoutDesignerPlaces){C=C.concat(E.layoutDesignerPlaces.getContents());}else{C.push(E);}});return C;}});B.namespace("Bewype");B.Bewype.LayoutDesignerPlaces=A;},"@VERSION@",{requires:["sortable","bewype-layout-designer-content"]});