YUI.add("bewype-layout-designer-places",function(b){var a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="layout-designer-places";a.NS="layoutDesignerPlaces";a.H_PLACES_TEMPLATE='<table class="{placesClass}-horizontal">';a.H_PLACES_TEMPLATE+="<tr />";a.H_PLACES_TEMPLATE+="</table>";a.V_PLACES_TEMPLATE='<table class="{placesClass}-vertical"></table>';a.C_TEMPLATE='<div class="{contentClass}">{defaultContent}</div>';a.H_DEST_TEMPLATE='<td class="{destClass}-horizontal"><div class="container-{destClass}" /></td>';a.V_DEST_TEMPLATE='<tr class="{destClass}-vertical">';a.V_DEST_TEMPLATE+='<div class="container-{destClass}" />';a.V_DEST_TEMPLATE+="</td>";a.V_DEST_TEMPLATE+="</tr>";a.ATTRS={contentHeight:{value:40,validator:function(c){return b.Lang.isNumber(c);}},contentWidth:{value:140,validator:function(c){return b.Lang.isNumber(c);}},placesType:{value:"vertical",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},placesClass:{value:"places",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},destClass:{value:"dest",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},contentClass:{value:"content",writeOnce:true,validator:function(c){return b.Lang.isString(c);}},defaultContent:{value:"Click to change your content..",validator:function(c){return b.Lang.isString(c);}},parentNode:{value:null}};b.extend(a,b.Plugin.Base,{placesNode:null,contents:null,sortable:null,initializer:function(d){var f=this.get("host"),e=this.get("placesType"),c=a.H_PLACES_TEMPLATE;_vTmpl=a.V_PLACES_TEMPLATE;_placesTempl=(e==="horizontal")?c:_vTmpl,_parentNode=this.get("parentNode");this.placesNode=new b.Node.create(b.substitute(_placesTempl,{placesClass:this.get("placesClass")}));f.append(this.placesNode);this.placesNode.setStyle("height",this.get("contentHeight"));this.placesNode.setStyle("width",this.get("contentWidth"));this._initSortable();if(_parentNode){_parentNode.layoutDesignerPlaces.registerContent(f);}else{b.DD.DDM.on("drag:enter",this._onEnterGotcha);}this.contents=[];},_initSortable:function(){var c=this.get("placesType"),d=(c==="horizontal")?"td":"tr";if(this.sortable){this.sortable.destroy();}this.sortable=new b.Sortable({container:this.placesNode,nodes:d,opacity:".2"});},_onEnterGotcha:function(l){var e=l.drag,h=l.drag.get("node"),c=h.one("div.content"),k=l.drop.get("node"),f=k.ancestor("div"),j=null,i=null,d=null,n=null,m=null;if(c&&f&&c.layoutDesignerContent&&f.layoutDesignerPlaces&&f.layoutDesignerPlaces.get("placesType")==="vertical"&&f.layoutDesignerPlaces.contents.indexOf(c)==-1){j=c.layoutDesignerContent.get("parentNode");i=c.get("innerHTML");d=c.getStyle("cssText");n=c.ancestor("td");if(n.drop){c.unplug(b.Bewype.LayoutDesignerContent);n.drop.removeFromGroup(j.layoutDesignerPlaces.sortable);n.remove();m=j.layoutDesignerPlaces.addContent();m.set("innerHTML",i);m.setStyle("cssText",d);j.layoutDesignerTarget.refresh();e.removeFromGroup(j.layoutDesignerPlaces.sortable);e.stopDrag();e.end();try{l.stopImmediatePropagation();l.halt();}catch(g){}}}},destructor:function(){var c=this.get("host"),d=this.get("parentNode");b.Object.each(this.contents,function(f,e){if(f.layoutDesignerPlaces){f.layoutDesignerPlaces.destroy();}else{this.removeContent(f);}},this);if(d){d.layoutDesignerPlaces.unRegisterContent(c);}this.placesNode.remove();},_getHeight:function(d,c){c=c?c:0;return parseInt(d.getComputedStyle("height")||d.getAttribute("height"),c);},_getWidth:function(d,c){c=c?c:0;return parseInt(d.getComputedStyle("width")||d.getAttribute("width"),c);},hasSubPlaces:function(){var c=false;b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c=true;}});return c;},hasPlace:function(){var e=this.get("parentNode")||this.placesNode.ancestor("div"),c=null,d=null;switch(this.get("placesType")){case"vertical":return true;case"horizontal":c=this._getWidth(e);d=this.getPlacesWidth();return c>=(d+this.get("contentWidth"));}},getPlacesWidth:function(){var c=0;switch(this.get("placesType")){case"vertical":b.each(this.contents,function(e,d){var f=0;if(e.layoutDesignerPlaces){f=e.layoutDesignerPlaces.getPlacesWidth();}else{f=e.layoutDesignerContent.getContentWidth();}if(f>c){c=f;}});break;case"horizontal":b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c+=e.layoutDesignerPlaces.getPlacesWidth();}else{c+=e.layoutDesignerContent.getContentWidth();}});break;}return(c==0)?this.get("contentWidth"):c;},getPlacesHeight:function(){var c=0;switch(this.get("placesType")){case"vertical":b.each(this.contents,function(e,d){if(e.layoutDesignerPlaces){c+=e.layoutDesignerPlaces.getPlacesHeight();}else{c+=e.layoutDesignerContent.getContentHeight();}});break;case"horizontal":b.each(this.contents,function(e,d){var f=0;if(e.layoutDesignerPlaces){f=e.layoutDesignerPlaces.getPlacesHeight();}else{f=e.layoutDesignerContent.getContentHeight();}if(f>c){c=f;}});break;}return(c==0)?this.get("contentHeight"):c;},refresh:function(){var c=this.get("placesType"),d=this.getPlacesHeight(),f=this.getPlacesWidth(),e=this.get("parentNode");this.placesNode.setStyle("height",d);this.placesNode.setStyle("width",f);switch(c){case"vertical":b.each(this.contents,function(i,h){var g=null;if(i.layoutDesignerPlaces){g=i.layoutDesignerPlaces.placesNode;g.setStyle("width",f);}});break;case"horizontal":b.each(this.contents,function(i,h){var g=null;if(i.layoutDesignerPlaces){g=i.layoutDesignerPlaces.placesNode;}else{g=i.layoutDesignerContent.get("host");}g.ancestor("td").setStyle("height",d);g.ancestor("td").setStyle("vertical-align","top");});break;}if(e){e.layoutDesignerTarget.refresh();}else{this.placesNode.ancestor("div").setStyle("height",d);}return[d,f];},cleanContentOver:function(){b.each(this.contents,function(d,c){if(d.layoutDesignerContent){d.layoutDesignerContent._q.stop();d.layoutDesignerContent.hideClone();}});},addDestNode:function(){if(!this.hasPlace()){return null;}var d=null,c=this.placesNode.one("tr");switch(this.get("placesType")){case"horizontal":d=new b.Node.create(b.substitute(a.H_DEST_TEMPLATE,{destClass:this.get("destClass")}));
c.append(d);break;case"vertical":d=new b.Node.create(b.substitute(a.V_DEST_TEMPLATE,{destClass:this.get("destClass")}));this.placesNode.append(d);break;}return d.one("div");},registerContent:function(c){this.contents.push(c);},unRegisterContent:function(c){var d=this.contents.indexOf(c);this.contents.splice(d,1);},addContent:function(){if(!this.hasPlace()){return null;}var d=this.addDestNode(),c=new b.Node.create(b.substitute(a.C_TEMPLATE,{contentClass:this.get("contentClass")}));d.append(c);c.plug(b.Bewype.LayoutDesignerContent,{contentHeight:this.get("contentHeight"),contentWidth:this.get("contentWidth"),contentZIndex:this.get("contentZIndex"),contentClass:this.get("contentClass"),defaultContent:this.get("defaultContent"),parentNode:this.get("host"),editCallback:this.get("editCallback"),removeCallback:b.bind(this.removeContent,this)});return c;},removeContent:function(c){var e=null,d=this.get("host");switch(this.get("placesType")){case"horizontal":e=c.ancestor("td");break;case"vertical":e=c.ancestor("tr");break;}this.unRegisterContent(c);e.remove();d.layoutDesignerTarget.refresh();}});b.namespace("Bewype");b.Bewype.LayoutDesignerPlaces=a;},"@VERSION@",{requires:["sortable","bewype-layout-designer-content"]});