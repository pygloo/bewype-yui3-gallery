YUI.add("bewype-layout-designer-content",function(b){var a=function(c){a.superclass.constructor.apply(this,arguments);};a.NAME="layout-designer-content";a.NS="layoutDesignerContent";b.extend(a,b.Bewype.LayoutDesignerConfig,{_q:null,editing:false,initializer:function(c){this.setAttrs(c);var e=this.get("host"),d=this.get("designerClass"),f=this.get("contentType");e.removeClass(d+"-src");e.addClass(d+"-content");e.addClass(d+"-content-"+f);b.on("mouseenter",b.bind(this._onMouseEnter,this),e);this._q=new b.AsyncQueue();},destructor:function(){var e=this.get("host"),f=this.get("parentNode"),d=this.get("designerClass")+"-content",c=this.getCloneNode();if(this.editing===true){this._detachEditor();}f.layoutDesignerPlaces.unRegisterContent(e);e.detachAll("mouseenter");if(c){c.one("."+d+"-clone-edit").detachAll("click");c.one("."+d+"-clone-remove").detachAll("click");c.remove();}},getCloneNode:function(){var e=this.get("host"),c=e.ancestor("div"),d=this.get("designerClass")+"-content";return c.one("div."+d+"-clone");},hideClone:function(c){c=c||this.getCloneNode();if(c){b.each(c.all("div"),function(e,d){e.setStyle("visibility","hidden");});c.setStyle("visibility","hidden");}},_addCloneNode:function(){var i=this.get("host"),d=i.ancestor("div"),c=this.get("designerClass")+"-content",f=new b.Node.create('<div class="'+c+'-clone" />'),h=new b.Node.create('<div class="'+c+'-clone-callbacks" />'),e=null,j=c+"-clone-drag",k=null,g=null;d.append(f);f.setStyle("bottom",0);f.setStyle("left",1);f.setStyle("position","absolute");f.setStyle("z-index",this.get("cloneZIndex"));f.append(h);e=new b.Node.create('<div class="'+j+'" />');h.append(e);k=new b.Node.create('<div class="'+c+'-clone-edit" />');h.append(k);b.on("click",b.bind(this._onClickEdit,this),k);g=new b.Node.create('<div class="'+c+'-clone-remove" />');h.append(g);b.on("click",b.bind(this._onClickRemove,this),g);this._refreshCloneNode();return f;},_attachEditor:function(){var m=this.get("host"),g=this.get("baseNode"),d=this.get("parentNode"),l=this.get("designerClass")+"-sources",k=this.get("designerClass")+"-edit-panel",q=g.one("div."+l),j=g.one("div."+k),p=d.layoutDesignerPlaces,f=p.get("placesType"),i=this.get("contentType")==="image"?b.Bewype.EditorTag:b.Bewype.EditorText,e=this.get("contentType")==="image"?"editorImageButtons":"editorTextButtons",h=null,o=null,n=(f==="vertical")?p.get("parentNode"):null,c=n?n.layoutDesignerPlaces:null;q.setStyle("display","none");j.setStyle("display","block");if(f==="vertical"){o=d.layoutDesignerPlaces.getMaxWidth();o+=c?c.getAvailablePlace():0;}else{o=d.layoutDesignerPlaces.getAvailablePlace();o+=this.getContentWidth();}h={panelNode:j,spinnerMaxWidth:o,activeButtons:this.get(e)};m.plug(i,h);b.on("bewype-editor:onClose",b.bind(this._detachEditor,this),m);b.on("bewype-editor:onChange",b.bind(this.refresh,this),m);this.editing=true;},_detachEditor:function(){var f=this.get("host"),e=this.get("baseNode"),i=this.get("designerClass")+"-sources",d=this.get("designerClass")+"-edit-panel",h=e.one("div."+i),c=e.one("div."+d),g=this.get("contentType")==="image"?b.Bewype.EditorTag:b.Bewype.EditorText;this.editing=false;if(c&&c.bewypeEditorPanel){c.unplug(b.Bewype.EditorPanel);f.unplug(g);f.detachAll("bewype-editor:onClose");f.detachAll("bewype-editor:onChange");this.refresh();}if(c){c.setStyle("display","none");}if(h){h.setStyle("display","block");}this._refreshCloneNode();return true;},_onClickEdit:function(c){var d=this.get("parentNode");b.each(d.layoutDesignerPlaces.getContents(),function(f,e){f.layoutDesignerContent._detachEditor();});this._attachEditor();},_onClickRemove:function(c){var d=this.get("host"),e=this.get("parentNode");e.layoutDesignerPlaces.removeContent(d);},_onMouseEnter:function(c){if(this.editing){return;}var e=this.get("parentNode"),d=this.getCloneNode();e.layoutDesignerPlaces.cleanContentOver();if(d){b.each(d.all("div"),function(g,f){g.setStyle("visibility","visible");});d.setStyle("visibility","visible");}else{d=this._addCloneNode();}this._q.stop();this._q.add({fn:function(){},timeout:1000},{fn:this.hideClone,args:[d]});this._q.run();},getContentHeight:function(){var d=this.get("host"),c=b.Bewype.Utils.getHeight(d),f=b.Bewype.Utils.getStyleValue(d,"paddingTop")||0,e=b.Bewype.Utils.getStyleValue(d,"paddingBottom")||0;return c+f+e+2;},getContentWidth:function(){var e=this.get("host"),f=b.Bewype.Utils.getWidth(e),d=b.Bewype.Utils.getStyleValue(e,"paddingRight")||0,c=b.Bewype.Utils.getStyleValue(e,"paddingLeft")||0;return f+c+d+2;},_refreshCloneNode:function(e){var d=this.getCloneNode(),f=this.getContentHeight(),c=e||this.getContentWidth();if(d){d.setStyle("height",f-2);d.setStyle("width",c-2);}},refresh:function(f,e){var g=this.get("parentNode"),d=this.get("host"),c=null;if(f){c=this.getContentWidth();if(e){c=f;}else{if(f){c=c>f?f:c;}}c-=2;d.setStyle("width",c);d.setStyle("paddingLeft",0);d.setStyle("paddingRight",0);this._refreshCloneNode(c);}else{this._refreshCloneNode();}}});b.namespace("Bewype");b.Bewype.LayoutDesignerContent=a;},"@VERSION@",{requires:["async-queue","plugin","substitute","bewype-layout-designer-config","bewype-editor"]});