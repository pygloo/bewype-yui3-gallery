YUI.add("bewype-layout-designer-target",function(B){var A=function(C){A.superclass.constructor.apply(this,arguments);};A.NAME="layout-designer-target";A.NS="layoutDesignerTarget";B.extend(A,B.Bewype.LayoutDesignerConfig,{_targetNode:null,_dd:null,_groups:["horizontal","vertical","text","image"],initializer:function(D){this.setAttrs(D);var H=this.get("host"),F=this.get("targetType"),G=this.get("designerClass")+"-target",C=this.get("layoutWidth"),J=this.get("contentHeight"),I=this.get("contentWidth"),K=this.get("targetMinHeight"),L=this.get("targetMinWidth"),E=null;this._targetNode=new B.Node.create('<div class="'+G+" "+G+"-"+F+'" />');H.append(this._targetNode);if(F==="vertical"||F==="start"){E=H.ancestor("table")?I:C;this._targetNode.setStyle("height",K);this._targetNode.setStyle("width",E);}else{if(F==="horizontal"){this._targetNode.setStyle("height",J);this._targetNode.setStyle("width",L);}else{return;}}this._targetNode.setStyle("z-index",this.get("targetZIndex"));this._dd=new B.DD.Drop({node:this._targetNode,groups:this._groups,target:true,after:{"drop:enter":B.bind(this._onDropEnter,this),"drop:hit":B.bind(this._onDropHit,this),"drop:exit":B.bind(this._afterDropExit,this)}});if(F!="start"){B.on("mouseenter",B.bind(this._onMouseEnter,this),this._targetNode);B.on("mouseleave",B.bind(this._onMouseLeave,this),this._targetNode);}},destructor:function(){var C=this.get("host"),D=this._targetNode.one("div");this._dd.detachAll("drop:enter");this._dd.detachAll("drop:hit");this._dd.detachAll("drop:exit");if(D){D.detachAll("click");}this._targetNode.detachAll("mouseenter");this._targetNode.detachAll("mouseleave");this._targetNode.remove();C.unplug(B.Bewype.LayoutDesignerPlaces);},_onDropEnter:function(C){switch(this.get("targetType")){case"start":case"vertical":this._targetNode.setStyle("height",this.get("contentHeight"));break;case"horizontal":this._targetNode.setStyle("width",this.get("contentWidth"));break;}this.refresh();},_afterDropExit:function(C,D){switch(this.get("targetType")){case"start":case"vertical":this._targetNode.setStyle("height",this.get("targetMinHeight"));break;case"horizontal":this._targetNode.setStyle("width",this.get("targetMinWidth"));break;}this.refresh(D);},_onClickRemove:function(C){var E=this.get("host"),F=this.get("parentNode"),D=E.layoutDesignerPlaces.get("placesType"),G=E.layoutDesignerPlaces.placesNode;switch(D){case"horizontal":E.one("table").remove();break;case"vertical":E.one("ul").remove();break;}E.unplug(B.Bewype.LayoutDesignerTarget);E.unplug(B.Bewype.LayoutDesignerPlaces);if(F&&F.layoutDesignerTarget){E.remove(true);F.layoutDesignerTarget.refresh();}else{E.setStyle("height",this.get("targetMinHeight"));this._addTarget(E,"start");}},_onMouseEnter:function(C){var E=this.get("targetType"),D=this.get("designerClass")+"-target",F=this._targetNode.one("div");switch(E){case"start":case"vertical":this._targetNode.setStyle("height",this.get("targetOverHeight"));break;case"horizontal":this._targetNode.setStyle("width",this.get("targetOverWidth"));break;}if(F){F.setStyle("display","block");}else{F=new B.Node.create('<div class="'+D+"-remove "+D+"-"+E+'-remove" />');this._targetNode.append(F);B.on("click",B.bind(this._onClickRemove,this),F);}this.refresh();},_onMouseLeave:function(C){var D=this._targetNode.one("div");D.setStyle("display","none");this._afterDropExit(C);},_addPlaces:function(G,E){var D=this.get("host"),C=this.get("targetType"),F=this.getAttrs();F.placesType=E;F.parentNode=(C==="start"||E==="start")?null:D;G.plug(B.Bewype.LayoutDesignerPlaces,F);},_addTarget:function(G,E){var D=this.get("host"),C=this.get("targetType"),F=this.getAttrs();F.targetType=E;F.parentNode=(C==="start"||E==="start")?null:D;G.plug(B.Bewype.LayoutDesignerTarget,F);},_getHitType:function(C){var D=C.drag;if(D._groups.vertical){return"vertical";}else{if(D._groups.horizontal){return"horizontal";}else{if(D._groups.text){return"text";}else{if(D._groups.image){return"image";}else{return null;}}}}},_onDropHit:function(C){var E=this.get("host"),D=this.get("targetType"),F=this._getHitType(C),I=null,H=E.layoutDesignerPlaces,G=null;if(D==="start"){if(F==="text"||F==="image"){return this._afterDropExit(C);}E.unplug(B.Bewype.LayoutDesignerTarget);if(E.layoutDesignerPlaces){E.unplug(B.Bewype.LayoutDesignerPlaces);}}if(F===D){return;}else{if(F==="start"||F==="horizontal"||F==="vertical"){if(H&&H.get("placesType")!=="vertical"){G=H.getMaxWidth();}I=D==="start"?E:H.addDestNode();this._addPlaces(I,F);this._addTarget(I,F);if(F!=="start"){I.layoutDesignerTarget.refresh();}}else{G=H.addContent(F);G=H.get("placesType")==="vertical"?null:G;}}this._afterDropExit(C,G);},refresh:function(G){var H=this.get("host"),E=this.get("targetType"),I=this.get("parentNode")||H,L=null,K=null,J=null,F=null,C=null,D=null;if(H.layoutDesignerPlaces){L=H.layoutDesignerPlaces.refresh(G);}else{return;}K=L[0];J=L[1];F=B.Bewype.Utils.getHeight(this._targetNode);C=B.Bewype.Utils.getWidth(this._targetNode);D=this._targetNode.ancestor("div");switch(E){case"vertical":K=B.Bewype.Utils.getHeight(I);if(I==H){this._targetNode.setY(I.getY()+K-F);}else{this._targetNode.setStyle("position","absolute");this._targetNode.setStyle("bottom",0);}this._targetNode.setStyle("width",J);break;case"horizontal":J=B.Bewype.Utils.getWidth(I);this._targetNode.setX(I.getX()+J-C);if(I==H){this._targetNode.setY(I.getY());}else{this._targetNode.setStyle("position","absolute");this._targetNode.setStyle("bottom",0);}this._targetNode.setStyle("height",K);break;default:return;}if(I.layoutDesignerTarget&&I!=H&&!G){I.layoutDesignerTarget.refresh();}}});B.namespace("Bewype");B.Bewype.LayoutDesignerTarget=A;},"@VERSION@",{requires:["bewype-layout-designer-places"]});