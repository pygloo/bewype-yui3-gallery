YUI.add("editor-bidi",function(h){var g=function(){g.superclass.constructor.apply(this,arguments);},c="host",b="dir",d="BODY",a="nodeChange",f="bidiContextChange",e=d+" > p";h.extend(g,h.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var j=this.get(c),l=j.getInstance(),k=new l.Selection(),i,m;if(k.isCollapsed){i=g.blockParent(k.focusNode);m=i.getStyle("direction");if(m!==this.lastDirection){j.fire(f,{changedTo:m});this.lastDirection=m;}}else{j.fire(f,{changedTo:"select"});this.lastDirection=null;}},_afterNodeChange:function(i){if(this.firstEvent||g.EVENTS[i.changedType]){this._checkForChange();this.firstEvent=false;}},_afterMouseUp:function(i){this._checkForChange();this.firstEvent=false;},initializer:function(){var i=this.get(c);this.firstEvent=true;i.after(a,h.bind(this._afterNodeChange,this));i.after("dom:mouseup",h.bind(this._afterMouseUp,this));}},{EVENTS:{"backspace-up":true,"pageup-up":true,"pagedown-down":true,"end-up":true,"home-up":true,"left-up":true,"up-up":true,"right-up":true,"down-up":true,"delete-up":true},BLOCKS:h.Selection.BLOCKS+",LI,HR,"+d,DIV_WRAPPER:"<DIV></DIV>",blockParent:function(k,j){var i=k,m,l;if(!i){i=h.one(d);}if(!i.test(g.BLOCKS)){i=i.ancestor(g.BLOCKS);}if(j&&i.test(d)){m=h.Node.create(g.DIV_WRAPPER);i.get("children").each(function(o,n){if(n===0){l=o;}else{m.append(o);}});l.replace(m);m.prepend(l);i=m;}return i;},_NODE_SELECTED:"bidiSelected",addParents:function(m){var j,l,k;for(j=0;j<m.length;j+=1){m[j].setData(g._NODE_SELECTED,true);}for(j=0;j<m.length;j+=1){l=m[j].get("parentNode");if(!l.test(d)&&!l.getData(g._NODE_SELECTED)){k=true;l.get("children").some(function(i){if(!i.getData(g._NODE_SELECTED)){k=false;return true;}});if(k){m.push(l);l.setData(g._NODE_SELECTED,true);}}}for(j=0;j<m.length;j+=1){m[j].clearData(g._NODE_SELECTED);}return m;},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:false}}});h.namespace("Plugin");h.Plugin.EditorBidi=g;h.Plugin.ExecCommand.COMMANDS.bidi=function(l,p){var o=this.getInstance(),j=new o.Selection(),i,m,n,q,k;o.Selection.filterBlocks();if(j.isCollapsed){m=g.blockParent(j.anchorNode);if(!p){k=m.getAttribute(b);if(!k||k=="ltr"){p="rtl";}else{p="ltr";}}m.setAttribute(b,p);i=m;}else{n=j.getSelected();q=[];n.each(function(r){q.push(g.blockParent(r));});q=o.all(g.addParents(q));q.setAttribute(b,p);i=q;}this.get(c).get(c).editorBidi._checkForChange();return i;};},"@VERSION@",{requires:["editor-base"],skinnable:false});