YUI.add("editor-para",function(a){var d=function(){d.superclass.constructor.apply(this,arguments);},k="host",f="body",c="nodeChange",j="parentNode",b=f+" > p",h="p",g="<br>",i="firstChild",e="li";a.extend(d,a.Base,{_fixFirstPara:function(){var l=this.get(k),n=l.getInstance(),m;n.one("body").set("innerHTML","<"+h+">"+n.Selection.CURSOR+"</"+h+">");m=new n.Selection();m.focusCursor(true,false);},_onNodeChange:function(R){var G=this.get(k),r=G.getInstance(),y,E,D,T,O,I=r.Selection.DEFAULT_BLOCK_TAG,A,o,u,P,w,l,H,M,v,N,V,S,K,C,B,Q=":last-child";switch(R.changedType){case"enter-up":var m=((this._lastPara)?this._lastPara:R.changedNode),U=m.one("br.yui-cursor");if(this._lastPara){delete this._lastPara;}if(U){if(U.previous()||U.next()){U.remove();}}if(!m.test(I)){var F=m.ancestor(I);if(F){m=F;F=null;}}if(m.test(I)){var J=m.previous(),L,x,z=false;if(J){L=J.one(Q);while(!z){if(L){x=L.one(Q);if(x){L=x;}else{z=true;}}else{z=true;}}if(L){G.copyStyles(L,m);}}}break;case"enter":if(a.UA.webkit){if(R.changedEvent.shiftKey){G.execCommand("insertbr");R.changedEvent.preventDefault();}}if(a.UA.gecko&&G.get("defaultblock")!=="p"){D=R.changedNode;if(!D.test(e)&&!D.ancestor(e)){if(!D.test(I)){D=D.ancestor(I);}T=r.Node.create("<"+I+"></"+I+">");D.insert(T,"after");O=new r.Selection();if(O.anchorOffset){A=O.anchorNode.get("textContent");E=r.one(r.config.doc.createTextNode(A.substr(0,O.anchorOffset)));o=r.one(r.config.doc.createTextNode(A.substr(O.anchorOffset)));P=O.anchorNode;P.setContent("");l=P.cloneNode();l.append(o);H=false;v=P;while(!H){v=v.get(j);if(v&&!v.test(I)){M=v.cloneNode();M.set("innerHTML","");M.append(l);u=v.get("childNodes");var s=false;u.each(function(n){if(s){M.append(n);}if(n===P){s=true;}});P=v;l=M;}else{H=true;}}o=l;O.anchorNode.append(E);if(o){T.append(o);}}if(T.get(i)){T=T.get(i);}T.prepend(r.Selection.CURSOR);O.focusCursor(true,true);y=r.Selection.getText(T);if(y!==""){r.Selection.cleanCursor();}R.changedEvent.preventDefault();}}break;case"keydown":if(r.config.doc.childNodes.length<2){var q=r.config.doc.body.innerHTML;if(q&&q.length<5&&q.toLowerCase()==g){this._fixFirstPara();}}break;case"backspace-up":case"backspace-down":case"delete-up":if(!a.UA.ie){N=r.all(b);S=r.one(f);if(N.item(0)){S=N.item(0);}V=S.one("br");if(V){V.removeAttribute("id");V.removeAttribute("class");}E=r.Selection.getText(S);E=E.replace(/ /g,"").replace(/\n/g,"");C=S.all("img");if(E.length===0&&!C.size()){if(!S.test(h)){this._fixFirstPara();}K=null;if(R.changedNode&&R.changedNode.test(h)){K=R.changedNode;}if(!K&&G._lastPara&&G._lastPara.inDoc()){K=G._lastPara;}if(K&&!K.test(h)){K=K.ancestor(h);}if(K){if(!K.previous()&&K.get(j)&&K.get(j).test(f)){R.changedEvent.frameEvent.halt();}}}if(a.UA.webkit){if(R.changedNode){S=R.changedNode;if(S.test("li")&&(!S.previous()&&!S.next())){y=S.get("innerHTML").replace(g,"");if(y===""){if(S.get(j)){S.get(j).replace(r.Node.create(g));R.changedEvent.frameEvent.halt();R.preventDefault();r.Selection.filterBlocks();}}}}}}if(a.UA.gecko){T=R.changedNode;B=r.config.doc.createTextNode(" ");T.appendChild(B);T.removeChild(B);}break;}if(a.UA.gecko){if(R.changedNode&&!R.changedNode.test(I)){var K=R.changedNode.ancestor(I);if(K){this._lastPara=K;}}}},_afterEditorReady:function(){var m=this.get(k),n=m.getInstance(),l;if(n){n.Selection.filterBlocks();l=n.Selection.DEFAULT_BLOCK_TAG;b=f+" > "+l;h=l;}},_afterContentChange:function(){var l=this.get(k),m=l.getInstance();if(m&&m.Selection){m.Selection.filterBlocks();}},_afterPaste:function(){var l=this.get(k),n=l.getInstance(),m=new n.Selection();a.later(50,l,function(){n.Selection.filterBlocks();});},initializer:function(){var l=this.get(k);if(l.editorBR){a.error("Can not plug EditorPara and EditorBR at the same time.");return;}l.on(c,a.bind(this._onNodeChange,this));l.after("ready",a.bind(this._afterEditorReady,this));l.after("contentChange",a.bind(this._afterContentChange,this));if(a.Env.webkit){l.after("dom:paste",a.bind(this._afterPaste,this));}}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:false}}});a.namespace("Plugin");a.Plugin.EditorPara=d;},"@VERSION@",{requires:["node"],skinnable:false});