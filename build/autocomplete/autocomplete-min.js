YUI.add("autocomplete-base",function(F){var I=F.Lang,P=F.Array,H=F.Object,R=I.isArray,D=I.isFunction,Q=I.isObject,U=I.trim,K=F.Attribute.INVALID_VALUE,N="_functionValidator",X="_sourceSuccess",C="allowBrowserAutocomplete",G="inputNode",W="query",E="queryDelimiter",B="requestTemplate",L="results",M="resultListLocator",J="value",S="valueChange",A="clear",T=W,O=L;function V(){F.before(this._bindUIACBase,this,"bindUI");F.before(this._destructorACBase,this,"destructor");F.before(this._syncUIACBase,this,"syncUI");this.publish(A,{defaultFn:this._defClearFn,queueable:true});this.publish(T,{defaultFn:this._defQueryFn,queueable:true});this.publish(O,{defaultFn:this._defResultsFn,queueable:true});}V.ATTRS={allowBrowserAutocomplete:{value:false},inputNode:{setter:F.one,writeOnce:"initOnly"},maxResults:{value:0},minQueryLength:{value:1},query:{readOnly:true,value:null},queryDelay:{value:100},queryDelimiter:{value:null},requestTemplate:{setter:"_setRequestTemplate",value:null},resultFilters:{validator:R,value:[]},resultFormatter:{validator:N},resultHighlighter:{validator:N},resultListLocator:{setter:"_setLocator"},results:{readOnly:true,value:[]},resultTextLocator:{setter:"_setLocator"},source:{setter:"_setSource"},value:{value:""}};V.CSS_PREFIX="ac";V.UI_SRC=(F.Widget&&F.Widget.UI_SRC)||"ui";V.prototype={_bindUIACBase:function(){var Y=this.get(G);if(!Y){F.error("No inputNode specified.");}this._acBaseEvents=[Y.on(S,this._onInputValueChange,this),this.after(C+"Change",this._syncBrowserAutocomplete),this.after(S,this._afterValueChange)];},_destructorACBase:function(){var Y=this._acBaseEvents;while(Y&&Y.length){Y.pop().detach();}},_syncUIACBase:function(){this._syncBrowserAutocomplete();this.set(J,this.get(G).get(J));},_createArraySource:function(Z){var Y=this;return{sendRequest:function(a){Y[X](Z.concat(),a);}};},_createJSONPSource:function(a){var Y={},Z=this;return{sendRequest:function(b){var c=b.request;if(Y[c]){Z[X](Y[c],b);}else{a._config.on.success=function(d){Y[c]=d;Z[X](d,b);};a.send(c);}}};},_createObjectSource:function(Y){return{sendRequest:function(a){var b=a.request,Z=this;Z[X](H.owns(Y,b)?Y[b]:[],a);}};},_createStringSource:function(Z){var Y=this;if(/^select\s+/i.test(Z)){if(F.YQLRequest){return this._createYQLSource(Z);}else{F.error("yql module is not loaded");return K;}}else{if(F.JSONPRequest){return this._createJSONPSource(new F.JSONPRequest(Z,{format:function(a,b,c){return I.sub(a,{callback:b,query:Y.get(B)?c:encodeURIComponent(c)});}}));}else{F.error("jsonp module is not loaded");return K;}}},_createYQLSource:function(a){var Y={},Z=this;if(!this.get(M)){this.set(M,this._defaultYQLLocator);}return{sendRequest:function(b){var c=b.request;if(!Z.get(B)){c=encodeURIComponent(c);}if(Y[c]){Z[X](Y[c],b);}else{F.YQL(I.sub(a,{query:c}),function(d){Y[c]=d;Z[X](d,b);});}}};},_defaultYQLLocator:function(Z){var a=Z&&Z.query&&Z.query.results,Y;if(a&&Q(a)){Y=H.values(a)||[];a=Y.length===1?Y[0]:Y;}else{a=[];}return a;},_functionValidator:function(Y){return Y===null||D(Y);},_getObjectValue:function(b,a){if(!b){return;}for(var Z=0,Y=a.length;b&&Z<Y;Z++){b=b[a[Z]];}return b;},_parseResponse:function(a,Y,q){var f={data:q,query:a,results:[]},Z,d,n,e=Y&&Y.results,g=[],b,j,p,k,l,h=this.get(M),m,o,c;if(e&&h){e=h(e);}if(e){b=this.get("resultFilters");j=this.get("resultFormatter");p=this.get("resultHighlighter");m=this.get("maxResults");o=this.get("resultTextLocator");if(o){d=P.map(e,o);c=P.hash(d,e);}else{d=e;}for(k=0,l=b.length;k<l;++k){d=b[k](a,d);if(!d||!d.length){break;}}if(o){n=d;d=[];for(k=0,l=n.length;k<l;++k){d.push(c[n[k]]);}}else{n=[].concat(d);}Z=p?p(a,n):[].concat(n);if(j){Z=j(a,d,Z,n);}l=m>0?Math.min(m,Z.length):Z.length;for(k=0;k<l;++k){g[k]={display:Z[k],raw:d[k],text:n[k]};}f.results=g;}this.fire(O,f);},_parseValue:function(Y){var Z=this.get(E);if(Z){Y=Y.split(Z);Y=Y[Y.length-1];}return this._trimLeft(Y);},_setLocator:function(Y){if(this[N](Y)){return Y;}var Z=this;Y=Y.toString().split(".");return function(a){return a&&Z._getObjectValue(a,Y);};},_setRequestTemplate:function(Y){if(this[N](Y)){return Y;}Y=Y.toString();return function(Z){return I.sub(Y,{query:encodeURIComponent(Z)});};},_setSource:function(Y){if((Y&&D(Y.sendRequest))||Y===null){return Y;}else{if(typeof Y==="string"){return this._createStringSource(Y);}else{if(R(Y)){return this._createArraySource(Y);}else{if(Q(Y)){return this._createObjectSource(Y);}else{if(F.JSONPRequest&&Y instanceof F.JSONPRequest){return this._createJSONPSource(Y);}}}}}return K;},_sourceSuccess:function(Z,Y){Y.callback.success({data:Z,response:{results:Z}});},_syncBrowserAutocomplete:function(){var Y=this.get(G);if(Y.get("nodeName").toLowerCase()==="input"){Y.setAttribute("autocomplete",this.get(C)?"on":"off");}},_trimLeft:String.prototype.trimLeft?function(Y){return Y.trimLeft();}:function(Y){return Y.replace(/^\s+/,"");},_updateValue:function(Z){var b=this.get(E),a,Y,c;Z=this._trimLeft(Z);if(b){a=U(b);c=P.map(U(this.get(J)).split(b),U);Y=c.length;if(Y>1){c[Y-1]=Z;Z=c.join(a+" ");}Z=Z+a+" ";}this.set(J,Z);},_afterValueChange:function(d){var Z,a,Y=d.newVal,c,b;if(d.src!==V.UI_SRC){this._inputNode.set(J,Y);return;}c=this._parseValue(Y);if(c&&c.length>=this.get("minQueryLength")){Z=this.get("queryDelay");b=this;a=function(){b.fire(T,{inputValue:Y,query:c});};if(Z){clearTimeout(this._delay);this._delay=setTimeout(a,Z);}else{a();}}else{clearTimeout(this._delay);this.fire(A);}},_onInputValueChange:function(Z){var Y=Z.newVal;if(Y===this.get(J)){return;}this.set(J,Y,{src:V.UI_SRC});},_onResponse:function(Y,Z){if(Y&&Y===this.get(W)){this._parseResponse(Y,Z.response,Z.data);}},_defClearFn:function(){this._set(W,null);this._set(L,[]);},_defQueryFn:function(c){var a=c.query,Y,b,Z=this.get("source");this._set(W,a);if(a&&Z){b=this.get(B);Y=b?b(a):a;Z.sendRequest({request:Y,callback:{success:F.bind(this._onResponse,this,a)}});}},_defResultsFn:function(Y){this._set(L,Y[L]);}};F.AutoCompleteBase=V;},"@VERSION@",{optional:["jsonp","yql"],requires:["array-extras","base-build","event-valuechange","node-base"]});
YUI.add("autocomplete-list",function(B){var X=B.Node,L=B.Array,H=40,J=13,N=27,R=9,Q=38,U="_CLASS_ITEM",V="_CLASS_ITEM_ACTIVE",D="_CLASS_ITEM_HOVER",W="_SELECTOR_ITEM",F="activeItem",K="alwaysShowList",P="circular",T="hoveredItem",M="id",E="item",C="list",Z="result",I="results",S="visible",G="width",O="select",A=B.Base.create("autocompleteList",B.Widget,[B.AutoCompleteBase,B.WidgetPosition,B.WidgetPositionAlign,B.WidgetStack],{ITEM_TEMPLATE:"<li/>",LIST_TEMPLATE:"<ul/>",initializer:function(){var Y=this.get("inputNode");if(!Y){B.error("No inputNode specified.");}this._events=[];this._inputNode=Y;this[U]=this.getClassName(E);this[V]=this.getClassName(E,"active");this[D]=this.getClassName(E,"hover");this[W]="."+this[U];if(!this.get("align.node")){this.set("align.node",Y);}if(!this.get(G)){this.set(G,Y.get("offsetWidth"));}this.publish(O,{defaultFn:this._defSelectFn});},destructor:function(){while(this._events.length){this._events.pop().detach();}},bindUI:function(){this._bindInput();this._bindList();},renderUI:function(){var Y=this.get("contentBox"),a=this.get("listNode");if(!a){a=X.create(this.LIST_TEMPLATE);a.addClass(this.getClassName(C)).setAttrs({id:B.stamp(a),role:"listbox"});Y.append(a);}this._inputNode.addClass(this.getClassName("input")).setAttrs({"aria-autocomplete":C,"aria-live":"polite","aria-owns":a.get(M),role:"combobox"});if(this.get(K)){this.set(S,true);}this._contentBox=Y;this._listNode=a;},syncUI:function(){this._syncResults();this._syncVisibility();},hide:function(){return this.get(K)?this:this.set(S,false);},selectItem:function(Y){if(Y){if(!Y.hasClass(this[U])){return;}}else{Y=this.get(F);if(!Y){return;}}this.fire(O,{itemNode:Y,result:Y.getData(Z)});return this;},show:function(){return this.set(S,true);},_activateNextItem:function(){var a=this.get(F),Y;if(a){Y=a.next(this[W])||(this.get(P)?null:a);}else{Y=this._getFirstItemNode();}this._set(F,Y);return this;},_activatePrevItem:function(){var a=this.get(F),Y=a?a.previous(this[W]):this.get(P)&&this._getLastItemNode();this._set(F,Y||null);return this;},_add:function(Y){var a=[];L.each(B.Lang.isArray(Y)?Y:[Y],function(b){a.push(this._createItemNode(b).setData(Z,b));},this);a=B.all(a);this._listNode.append(a.toFrag());return a;},_bindInput:function(){var Y=this._inputNode;this._events.concat([Y.on("blur",this._onInputBlur,this),Y.on(B.UA.gecko?"keypress":"keydown",this._onInputKey,this)]);},_bindList:function(){this._events.concat([this.after("mouseover",this._afterMouseOver),this.after("mouseout",this._afterMouseOut),this.after("activeItemChange",this._afterActiveItemChange),this.after("alwaysShowListChange",this._afterAlwaysShowListChange),this.after("hoveredItemChange",this._afterHoveredItemChange),this.after("resultsChange",this._afterResultsChange),this.after("visibleChange",this._afterVisibleChange),this._listNode.delegate("click",this._onItemClick,this[W],this)]);},_clear:function(){this._set(F,null);this._set(T,null);this._listNode.get("children").remove(true);},_createItemNode:function(Y){var a=X.create(this.ITEM_TEMPLATE);return a.addClass(this[U]).setAttrs({id:B.stamp(a),role:"option"}).append(Y.display);},_getLastItemNode:function(){return this._listNode.one(this[W]+":last-child");},_getFirstItemNode:function(){return this._listNode.one(this[W]);},_syncResults:function(a){var Y;if(!a){a=this.get(I);}this._clear();if(a.length){Y=this._add(a);}if(this.get("activateFirstItem")&&!this.get(F)){this._set(F,this._getFirstItemNode());}},_syncVisibility:function(Y){if(typeof Y==="undefined"){Y=this.get(S);}this._contentBox.set("aria-hidden",!Y);if(!Y){this._set(F,null);this._set(T,null);}},_afterActiveItemChange:function(a){var Y=a.newVal,b=a.prevVal;if(b){b.removeClass(this[V]);}if(Y){Y.addClass(this[V]);this._inputNode.set("aria-activedescendant",Y.get(M));}},_afterAlwaysShowListChange:function(Y){this.set(S,Y.newVal||this.get(I).length>0);},_afterHoveredItemChange:function(a){var Y=a.newVal,b=a.prevVal;if(b){b.removeClass(this[D]);}if(Y){Y.addClass(this[D]);}},_afterMouseOver:function(Y){var a=Y.domEvent.target.ancestor(this[W],true);this._mouseOverList=true;if(a){this._set(T,a);}},_afterMouseOut:function(){this._mouseOverList=false;this._set(T,null);},_afterResultsChange:function(Y){this._syncResults(Y.newVal);if(!this.get(K)){this.set(S,!!Y.newVal.length);}},_afterVisibleChange:function(Y){this._syncVisibility(!!Y.newVal);},_onInputBlur:function(Y){if(this._mouseOverList&&this._lastInputKey!==R){this._inputNode.focus();}else{this.hide();}},_onInputKey:function(b){var Y,a=b.keyCode,c;this._lastInputKey=a;if(!this.get(I).length){return;}c=this.get(S);if(a===H){Y=1;if(!c){this.show();}this._activateNextItem();}if(c){switch(a){case J:Y=1;this.selectItem();break;case N:Y=1;this.hide();break;case R:if(this.get("tabSelect")){Y=1;this.selectItem();}break;case Q:Y=1;this._activatePrevItem();break;}}if(Y){b.preventDefault();}},_onItemClick:function(Y){var a=Y.currentTarget;Y.preventDefault();this._set(F,a);this.selectItem(a);},_defSelectFn:function(Y){this._inputNode.focus();this._updateValue(Y.result.text);this.hide();}},{ATTRS:{activateFirstItem:{value:false},activeItem:{readOnly:true,value:null},align:{value:{points:["tl","bl"]}},alwaysShowList:{value:false},circular:{value:true},hoveredItem:{readOnly:true,value:null},tabSelect:{value:true},visible:{value:false}},CSS_PREFIX:B.ClassNameManager.getClassName("aclist"),HTML_PARSER:{listNode:function(){return this.getClassName(C);}}});B.AutoCompleteList=A;B.AutoComplete=A;},"@VERSION@",{skinnable:true,requires:["autocomplete-base","widget","widget-position","widget-position-align","widget-stack"]});YUI.add("autocomplete",function(A){},"@VERSION@",{use:["autocomplete-base","autocomplete-list"]});