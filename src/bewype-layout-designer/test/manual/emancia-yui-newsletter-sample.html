<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
    <title>YUI3 Newsletter Designer</title> 
    <script type="text/javascript" src="../../../../build/yui/yui.js"></script>
</head> 
<body>  
    
    <div id="panel"></div>

    <div id="newsletter"></div>

    <script type="text/javascript">
    <!--
        YUI( { filter: 'debug' } ).use( 'bewype-layout-designer', 'bewype-editor', function ( Y ) {

            var _editCallback   = null,
                _newsletterNode = Y.one( "#newsletter" );                

            _editCallback = function( node ) {
                // get content nodes and stop editing all
                _contents = _newsletterNode.layoutDesigner.getContents();
                Y.each( _contents, function( v, k ) {
                    if ( v != node ) {
                        // update editing flag
                        v.layoutDesignerContent.editing = false;
                        // detach events
                        v.detachAll( 'bewype-editor:onClose'  );
                        v.detachAll( 'bewype-editor:onChange' );
                        // diconnect
                        v.unplug( Y.Bewype.Editor );
                    }
                } );
                // start/stop editing clicked node
                if ( node.bewypeEditor ) {
                    // detach events
                    node.detachAll( 'bewype-editor:onClose'  );
                    node.detachAll( 'bewype-editor:onChange' );
                    // disconnect
                    node.unplug( Y.Bewype.Editor );
                } else {

                    //
                    var _pNode          = node.layoutDesignerContent.get( 'parentNode' ),
                        _availableWidth = _pNode.layoutDesignerPlaces.getAvailablePlace(),
                        _conf           = { panelNode : Y.one( "#panel" ) },
                        _maxWidth       = null;

                    // set max width or not
                    if ( _availableWidth ) {
                        // compute max width
                        _maxWidth =  _availableWidth;
                        _maxWidth += node.layoutDesignerContent.getContentWidth();
                        // update conf
                        _conf[ 'spinnerMaxWidth' ] = _maxWidth;
                    }

                    // plug
                    node.plug( Y.Bewype.Editor, _conf );

                    // set on close event
                    Y.on( 'bewype-editor:onClose', function () {
                        // detach events
                        this.detachAll( 'bewype-editor:onClose'  );
                        this.detachAll( 'bewype-editor:onChange' );
                        //
                        // this.layoutDesignerContent.refresh();
                        this.layoutDesignerContent.editing = false;
                        this.layoutDesignerContent.refresh();
                    }, node );

                    // set on change event
                    Y.on( 'bewype-editor:onChange', function () {
                        // refresh
                        this.layoutDesignerContent.refresh();
                    }, node );
                }
            }

            // get demo node and plug - TODO replace CB with custom event
            _newsletterNode.plug( Y.Bewype.LayoutDesigner, {
                editCallback : _editCallback
            } );

        } );
    -->
    </script>
</body> 
</html> 

